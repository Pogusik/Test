<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CLscript Generator | SCP:SL</title>
    <link rel="icon" href="assets/pogusteam.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #9e85cf;
      --primary-dark: #66538d;
      --secondary: #e94560;
      --dark: #1e1e2d;
      --dark-light: #2a2a3c;
      --light: #f8f9fa;
      --gray: #6c757d;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #fd7e14;
      --info: #17a2b8;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 20px 0;
      border-radius: 8px 8px 0 0;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    header h1 {
      font-size: 2.2rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 10px;
    }
    
    header p {
      text-align: center;
      opacity: 0.9;
      font-weight: 300;
    }
    
    .panel {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      margin-bottom: 20px;
      overflow: hidden;
    }
    
    .panel-header {
      background-color: var(--primary);
      color: white;
      padding: 12px 20px;
      font-size: 1.2rem;
      font-weight: 500;
      display: flex;
      align-items: center;
    }
    
    .panel-header i {
      margin-right: 10px;
      font-size: 1.4rem;
    }
    
    .panel-body {
      padding: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-color);
    }
    
    .form-control {
      width: 100%;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
    }
    
    textarea.form-control {
      min-height: 100px;
      resize: vertical;
    }
    
    .slider-container {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .slider-container-wrapper {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .slider-container-wrapper > div {
      flex: 1;
      min-width: 250px;
    }
    
    .slider-container label {
      width: 150px;
      margin-right: 15px;
      font-weight: 500;
    }
    
    .slider-value {
      width: 60px;
      text-align: center;
      font-weight: 500;
      color: var(--primary);
    }
    
    input[type="range"] {
      flex-grow: 1;
      height: 8px;
      -webkit-appearance: none;
      background: #e0e0e0;
      border-radius: 4px;
      outline: none;
      margin-right: 15px;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: var(--primary);
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      background: var(--primary-dark);
    }
    
    .checkbox-group {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
    }
    
    .checkbox-item input {
      margin-right: 8px;
      width: 16px;
      height: 16px;
      accent-color: var(--primary);
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 20px;
      font-size: 1rem;
      font-weight: 500;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
    }
    
    .btn i {
      margin-right: 8px;
    }
    
    .btn-primary {
      background-color: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .btn-secondary {
      background-color: var(--secondary);
      color: white;
    }
    
    .btn-secondary:hover {
      background-color: #d13354;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }
    
    .btn-outline:hover {
      background-color: rgba(74, 111, 165, 0.1);
    }
    
    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .color-palette {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(30px, 1fr));
      gap: 8px;
      margin: 15px 0;
    }
    
    .color-option {
      width: 30px;
      height: 30px;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }
    
    .color-option:hover {
      transform: scale(1.1);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    
    .color-option.active {
      border-color: var(--dark);
      transform: scale(1.1);
    }
    
    .format-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .format-btn {
      padding: 8px 12px;
      background-color: #f0f0f0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
    }
    
    .format-btn:hover {
      background-color: #e0e0e0;
      transform: translateY(-1px);
    }
    
    .size-input {
      width: 50px;
      margin-left: 5px;
      padding: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .preview-container {
      margin-top: 15px;
      padding: 15px;
      border: 1px solid #eee;
      border-radius: 4px;
      background-color: #f9f9f9;
      min-height: 80px;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    .inventory {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .inventory-slot {
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 6px;
      min-height: 80px;
      background-color: var(--input-border);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    
    .inventory-slot:hover {
      background-color: var(---input-bg);
      transform: translateY(-2px);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .inventory-slot.active {
      border: 2px solid var(--primary);
      background-color: var(---input-bg);
    }
    
    .inventory-slot::after {
      content: attr(data-slot);
      position: absolute;
      top: 5px;
      left: 5px;
      font-size: 0.7rem;
      color: var(--gray);
    }
    
    .item-search-container {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .server-selector {
      margin-bottom: 15px;
    }
    
    .server-selector select {
      width: 100%;
    }
    
    .item-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 8px;
      max-height: 300px;
      overflow-y: auto;
      padding: 5px;
    }
    
    .item {
      padding: 10px;
      border: 1px solid #eee;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
      background-color: var(--input-border);
    }
    
    .item:hover {
      background-color: var(---input-bg);
      transform: translateY(-2px);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      border-color: var(--primary);
    }
    
    .item-name {
      font-weight: 500;
      margin-bottom: 3px;
    }
    
    .item-id {
      font-size: 0.8rem;
      color: var(--gray);
    }
    
    .custom-items-divider {
      display: flex;
      align-items: center;
      margin: 15px 0;
      color: var(--gray);
      font-weight: 500;
      grid-column: 1 / -1;
    }
    
    .custom-items-divider::before,
    .custom-items-divider::after {
      content: "";
      flex: 1;
      border-bottom: 1px solid #eee;
      margin: 0 10px;
    }
    
    .custom-items-divider img {
      width: 20px;
      height: 20px;
      margin: 0 5px;
    }
    /* Модальное окно выбора роли */
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgb(0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      width: 90%;
      max-width: 900px;
      height: 80vh;
      background-color: var(--dark-light);
      border-radius: 12px;
      overflow: hidden;
      display: flex;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.6);
      animation: modalFadeIn 0.3s ease;
    }
    
    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    /* Боковые фильтры */
    
    .filter-buttons {
      width: 80px;
      background-color: var(--dark);
      padding: 20px 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      border-right: 1px solid #333;
    }
    
    .filter-btn {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      background-color: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      border: 2px solid transparent;
    }
    
    .filter-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
    }
    
    .filter-btn.active {
      border-color: var(--secondary);
      box-shadow: 0 0 15px rgba(233, 69, 96, 0.5);
    }
    
    .filter-btn img {
      width: 70%;
      height: 70%;
      object-fit: contain;
    }
    /* Основной контейнер с ролями */
    
    .roles-container {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .search-box {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 20px;
      background-color: var(--dark);
      border: 1px solid #333;
      border-radius: 6px;
      color: white;
      font-size: 14px;
    }
    
    .search-box:focus {
      outline: none;
      border-color: var(--secondary);
    }
    
    .roles-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      grid-auto-rows: 25%;
      /* Каждая роль занимает 30% высоты контейнера */
      gap: 12px;
      padding: 5px;
      overflow-y: auto;
    }
    
    .role-option {
      height: 100%;
      /* Заполняет всю высоту ячейки */
      min-height: 0;
      /* Убирает ограничение минимальной высоты */
      box-sizing: border-box;
      /* Учитывает padding в высоту */
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .role-option::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: currentColor;
    }
    
    .role-option:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
    }
    
    .role-option.selected {
      box-shadow: 0 0 0 2px currentColor, 0 5px 15px rgba(0, 0, 0, 0.4);
    }
    
    .role-image {
      width: 60px;
      height: 60px;
      object-fit: contain;
      margin-bottom: 10px;
      border-radius: 50%;
      background-color: rgba(0, 0, 0, 0.3);
      padding: 5px;
      box-sizing: border-box;
      transition: transform 0.3s;
    }
    
    .role-option:hover .role-image {
      transform: scale(1.1);
    }
    
    .role-name {
      font-weight: bold;
      font-size: 13px;
      color: white;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
    }
    /* Закрытие модального окна */
    
    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 24px;
      color: #aaa;
      cursor: pointer;
      transition: color 0.3s;
      z-index: 1001;
    }
    
    .close-modal:hover {
      color: var(--secondary);
    }
    
    .role-preview-card {
      width: 100%;
      height: 140px;
      background: linear-gradient(135deg, #2a2a3c, #1e1e2d);
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transition: all 0.3s;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .role-preview-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
      border-color: var(--primary);
    }
    
    .role-preview-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      opacity: 0.8;
    }
    
    .role-preview-content {
      position: relative;
      z-index: 2;
      text-align: center;
      padding: 15px;
      width: 100%;
    }
    
    .role-preview-name {
      color: white;
      font-weight: 500;
      font-size: 1.1rem;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
      margin-bottom: 5px;
    }
    
    .role-preview-placeholder {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }
    
    .role-preview-icon {
      font-size: 2rem;
      color: rgba(255, 255, 255, 0.3);
      margin-bottom: 10px;
    }
    /* Группа панелей ролей и инфо */
    
    .role-info-group {
      display: flex;
      gap: 20px;
    }
    
    .role-info-group .panel {
      flex: 1;
    }
    /* Стиль для панели патронов */
    /* Разделительная линия в инвентаре */
    
    .custom-items-divider {
      display: flex;
      align-items: center;
      margin: 15px 0;
      color: var(--gray);
      font-weight: 500;
      grid-column: 1 / -1;
    }
    
    .custom-items-divider::before,
    .custom-items-divider::after {
      content: "";
      flex: 1;
      border-bottom: 1px solid #eee;
      margin: 0 10px;
    }
    /* Импорт скрипта */
    
    .import-container {
      margin-top: 15px;
    }
    
    .import-btn {
      margin-top: 10px;
    }
    
    .error-message {
      color: var(--danger);
      margin-top: 5px;
      font-size: 0.9rem;
    }
    
    .char-counter {
      text-align: right;
      font-size: 0.8rem;
      color: var(--gray);
      margin-top: 5px;
    }
    /* Адаптивность */
    
    @media (max-width: 768px) {
      .inventory {
        grid-template-columns: repeat(4, 1fr);
      }
      .item-list {
        grid-template-columns: repeat(2, 1fr);
      }
      .checkbox-group {
        grid-template-columns: repeat(2, 1fr);
      }
      .modal-content {
        flex-direction: column;
        height: 90vh;
      }
      .filter-buttons {
        width: 100%;
        flex-direction: row;
        padding: 10px;
        border-right: none;
        border-bottom: 1px solid #333;
      }
      .roles-grid {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      }
      .role-info-group {
        flex-direction: column;
      }
    }
    .role-info-antigroup {
      display: grid;
      gap: 20px;
    }
    
    @media (max-width: 480px) {
      .inventory {
        grid-template-columns: repeat(2, 1fr);
      }
      .item-list {
        grid-template-columns: 1fr;
      }
      .checkbox-group {
        grid-template-columns: 1fr;
      }
      .btn-group {
        flex-direction: column;
      }
      .btn {
        width: 100%;
      }
    }
    
    .role-preview-card {
      width: 100%;
      height: 540px;
      background: linear-gradient(135deg, #2a2a3c, #1e1e2d);
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transition: all 0.3s;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .role-preview-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
      border-color: var(--primary);
    }
    
    .role-preview-content {
      width: 100%;
      height: 100%;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    
    .role-preview-image {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    
    .role-preview-name {
      position: relative;
      z-index: 2;
      color: white;
      font-weight: 500;
      font-size: 1.1rem;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
      margin-bottom: 5px;
    }
    
    .role-preview-icon {
      font-size: 2rem;
      color: rgba(255, 255, 255, 0.3);
      margin-bottom: 10px;
    }
    
    .role-preview-placeholder {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }
    
    :root {
      --primary: #8869c7;
      --primary-dark: #66538d;
      --secondary: #e94560;
      --dark: #1e1e2d;
      --dark-light: #2a2a3c;
      --light: #f8f9fa;
      --gray: #6c757d;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #fd7e14;
      --info: #17a2b8;
      /* Цвета для светлой темы */
      --bg-color: #f5f7fa;
      --text-color: #333;
      --panel-bg: white;
      --panel-border: #eee;
      --input-bg: white;
      --input-border: #ddd;
      --preview-bg: #f9f9f9;
    }
    /* Темная тема */
    
    .dark-theme {
      --bg-color: #121212;
      --text-color: #e0e0e0;
      --panel-bg: #1e1e1e;
      --panel-border: #333;
      --input-bg: #2a2a2a;
      --input-border: #444;
      --preview-bg: #2a2a2a;
      --gray: #a2c2c4;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      transition: background-color 0.3s, color 0.3s, border-color 0.3s;
    }
    
    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
    }
    /* Стилизация скроллбара */
    
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--panel-bg);
      border-radius: 5px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 5px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }
    /* Переключатель темы */
    
    .theme-switcher {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
      background-color: var(--panel-bg);
      padding: 8px 12px;
      border-radius: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .theme-switcher label {
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.9rem;
    }
    
    .theme-switcher input[type="checkbox"] {
      appearance: none;
      width: 40px;
      height: 20px;
      background-color: var(--input-bg);
      border-radius: 20px;
      position: relative;
      cursor: pointer;
      border: 1px solid var(--input-border);
    }
    
    .theme-switcher input[type="checkbox"]::before {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      background-color: var(--primary);
      border-radius: 50%;
      top: 1px;
      left: 2px;
      transition: transform 0.3s;
    }
    
    .theme-switcher input[type="checkbox"]:checked::before {
      transform: translateX(20px);
    }
    /* Остальные стили остаются такими же, но с заменой цветов на CSS-переменные */
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 20px 0;
      border-radius: 8px 8px 0 0;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .panel {
      background-color: var(--panel-bg);
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      margin-bottom: 20px;
      overflow: hidden;
      border: 1px solid var(--panel-border);
    }
    
    .form-control {
      width: 100%;
      padding: 10px 15px;
      border: 1px solid var(--input-border);
      border-radius: 4px;
      font-size: 1rem;
      transition: border-color 0.3s;
      background-color: var(--input-bg);
      color: var(--text-color);
    }
    
    .preview-container {
      margin-top: 15px;
      padding: 15px;
      border: 1px solid var(--panel-border);
      border-radius: 4px;
      background-color: var(--preview-bg);
      min-height: 80px;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    .thumbnail-container {
      position: relative;
      width: 500px;
      height: 800px;
      border: 1px solid var(--input-border);
      border-radius: 8px;
      overflow: hidden;
      background-color: var(--panel-bg);
      margin-left: 20px;
    }
    
    .thumbnail-role-image {
      left: 17%;
      /* width: 100%; */
      height: 75%;
      object-fit: cover;
      position: relative;
    }
    
    .thumbnail-role-image[src*="350px-Capybara956.png"] {
      left: -10% !important;
    }
    
    .thumbnail-description-overlay {
      position: absolute;
      top: 35%;
      left: 5%;
      width: 90%;
      max-height: 200px;
      overflow-y: auto;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-size: 14px;
      line-height: 1.4;
      font-family: 'Roboto', sans-serif !important;
      /* Важно указать явно шрифт */
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }
    
    .thumbnail-items-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 5px;
      padding: 10px;
      background-color: var(--dark-light);
    }
    
    .thumbnail-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      font-size: 12px;
      background-color: var(--input-bg);
      padding: 5px;
      border-radius: 4px;
      height: 85px;
    }
    
    .thumbnail-item-img {
      width: 40px;
      height: 40px;
      object-fit: contain;
      margin-bottom: 2px;
    }
    
    .thumbnail-item-name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      width: 100%;
      font-size: 11px;
    }
    
    .thumbnail-item-id {
      font-size: 10px;
      color: var(--gray);
    }
    
    .export-thumbnail-group {
      display: flex;
      gap: 20px;
    }
    /* Кнопка сохранения миниатюры */
    
    .save-thumbnail-btn {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 4px;
      padding: 5px 10px;
      cursor: pointer;
      z-index: 10;
    }
    
    .default-border {
      border-color: var(--input-border);
    }
    
    .thumbnail-wrapper {
      margin-left: -10px;
      display: flex;
      flex-direction: column;
    }
    
    .thumbnail-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .thumbnail-actions .btn {
      flex: 1;
      padding: 8px 12px;
      font-size: 0.9rem;
    }
    .groups-container {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.group-list {
  max-height: 200px;
  overflow-y: auto;
  border: 1px solid var(--input-border);
  border-radius: 4px;
  padding: 5px;
}

.group-item {
  padding: 10px;
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  border-radius: 4px;
  transition: background-color 0.2s;
}

.group-item:hover {
  background-color: var(--input-bg);
}

.group-item.active {
  background-color: var(--primary);
  color: white;
}

.group-item i {
  width: 20px;
  text-align: center;
}

.group-script-count {
  margin-left: auto;
  font-size: 0.8em;
  opacity: 0.7;
}

.no-groups, .no-scripts {
  text-align: center;
  padding: 10px;
  color: var(--gray);
}

.group-scripts-list {
  max-height: 300px;
  overflow-y: auto;
  margin: 10px 0;
  border: 1px solid var(--input-border);
  border-radius: 4px;
  padding: 5px;
}

.group-script-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px;
  border-bottom: 1px solid var(--input-border);
}

.group-script-item:last-child {
  border-bottom: none;
}

.script-info {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.script-name {
  font-weight: bold;
}

.script-preview {
  font-size: 0.8em;
  color: var(--gray);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.group-script-actions {
  display: flex;
  gap: 5px;
  flex-wrap: wrap;
}

.group-script-actions .btn {
  flex: 1;
  min-width: 120px;
}
/* Модальные окна для уведомлений */
.notification-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  z-index: 2000;
  justify-content: center;
  align-items: center;
}

.notification-content {
  background-color: var(--panel-bg);
  border-radius: 8px;
  width: 90%;
  max-width: 400px;
  overflow: hidden;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  animation: modalFadeIn 0.3s ease;
}

.notification-header {
  padding: 15px 20px;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.notification-header h3 {
  margin: 0;
  font-size: 1.2rem;
  display: flex;
  align-items: center;
  gap: 10px;
}

.notification-body {
  padding: 20px;
  text-align: center;
}

.notification-footer {
  padding: 15px 20px;
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  border-top: 1px solid var(--panel-border);
}

.notification-icon {
  font-size: 2rem;
  margin-bottom: 15px;
}

.notification-success .notification-icon {
  color: var(--success);
}

.notification-error .notification-icon {
  color: var(--danger);
}

.notification-warning .notification-icon {
  color: var(--warning);
}

.notification-info .notification-icon {
  color: var(--info);
}
/* Стили для toast-уведомлений */
.toast-notification {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: var(--panel-bg);
  border-left: 4px solid var(--success);
  color: var(--text-color);
  padding: 15px 20px;
  border-radius: 4px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  display: flex;
  align-items: center;
  gap: 12px;
  z-index: 1000;
  transform: translateX(120%);
  transition: transform 0.3s ease-out;
}

.toast-notification.show {
  transform: translateX(0);
}

.toast-notification.success {
  border-left-color: var(--success);
}

.toast-notification.error {
  border-left-color: var(--danger);
}

.toast-notification.warning {
  border-left-color: var(--warning);
}

.toast-notification.info {
  border-left-color: var(--info);
}

.toast-icon {
  font-size: 1.5rem;
}

.toast-success .toast-icon {
  color: var(--success);
}

.toast-error .toast-icon {
  color: var(--danger);
}

.toast-warning .toast-icon {
  color: var(--warning);
}

.toast-info .toast-icon {
  color: var(--info);
}

.toast-close {
  margin-left: 15px;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.2s;
}

.toast-close:hover {
  opacity: 1;
}
/* Стили для настроек скриптов и групп */
.script-name-input {
  background: transparent;
  border: none;
  border-bottom: 1px dashed var(--gray);
  color: var(--text-color);
  font-weight: bold;
  padding: 2px 5px;
  width: 120px;
  margin-bottom: 5px;
}

.script-name-input:focus {
  outline: none;
  border-bottom: 1px solid var(--primary);
}

.script-settings-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

.script-settings-content {
  background-color: var(--panel-bg);
  border-radius: 8px;
  width: 90%;
  max-width: 500px;
  padding: 20px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
}

.group-settings-modal {
  /* аналогичные стили для модального окна групп */
}
.group-script-actions {
  display: flex;
  gap: 10px;
  margin-top: 15px;
  flex-wrap: wrap;
}

.group-script-actions .btn {
  flex: 1;
  min-width: 120px;
}

.script-actions {
  display: flex;
  gap: 5px;
}

.script-actions .btn {
  padding: 5px 8px;
  font-size: 0.8rem;
}

/* Для модального окна настроек группы */
.notification-footer {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  flex-wrap: wrap;
}

.notification-footer .btn {
  min-width: 120px;
}
.update-log-footer {
  padding: 15px 20px;
  display: flex;
  justify-content: space-between;
  gap: 10px;
  border-top: 1px solid var(--panel-border);
}
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>

  <!-- Апдэйт лог -->
<div class="update-log-modal" id="updateLogModal">
  <div class="update-log-content" id="updateLogContent">
    <!-- Добавленный опросник -->
    <div class="panel" style="background-color: var(--panel-bg); border: 2px dashed var(--primary); margin-bottom: 20px;">
      <div class="panel-header" style="background-color: var(--primary); color: white;">
        <i class="fas fa-poll"></i> Опросник
      </div>
      <div class="panel-body" style="text-align: center; padding: 15px;">
        <p style="margin-bottom: 15px;">Помогите улучшить генератор! Пройдите короткий опрос:</p>
        <a href="https://forms.gle/utrqD7csWebYj8o26" target="_blank" class="btn btn-primary" 
           style="display: inline-flex; align-items: center; gap: 8px;">
          <i class="fas fa-external-link-alt"></i> Пройти опрос
        </a>
      </div>
    </div>

    <div class="update-log-header">
      <h3><i class="fas fa-rocket"></i> Обновление v1.2</h3>
      <button class="close-update-log">&times;</button>
    </div>
    <div class="update-log-body">
      <ul class="update-list">
        <li><i class="fas fa-layer-group"></i> <strong>Новая система Групп</strong>
          <br>Теперь вы можете организовывать скрипты в группы для удобного хранения и управления. Доступно создание, редактирование, импорт/экспорт групп и управление скриптами внутри них.</li>

        <li><i class="fas fa-image"></i> <strong>Новая система миниатюр</strong>
          <br>Добавлен инструмент для создания визуальных превью персонажей с возможностью экспорта в PNG. Миниатюра включает изображение роли, описание, инвентарь и автоматически подстраивается под выбранный сервер.</li>

        <li><i class="fas fa-scroll"></i> <strong>Апдэйт лог?</strong>
          <br> Добавлена возможность посмотреть последний апдейт лог в любой удобный момент, находиться возле кнопки смены темы:
          <div style="text-align: center; margin: 15px 0;">
            <img src="assets/update1.2.png" alt="" style="max-width: 100%; border-radius: 8px; border: 1px solid var(--input-border);">
          </div>
        </li>

        <li><i class="fa-solid fa-border-top-left"></i> <strong>Новый стиль</strong>
          <div style="text-align: center; margin: 15px 0;">
            <img src="assets/pogusteam.png" alt="" style="max-width: 30%; border-radius: 8px; border: 1px solid var(--input-border);">
          </div>
        </li>

        <li><i class="fas fa-bug"></i> <strong>Исправления ошибок</strong>
          <br>- Оптимизирована работа генератора
          <br>- Мелкие исправления интерфейса
          <br>- Улучшена стабильность при работе с большими скриптами</li>
      </ul>
    </div>
    <div class="update-log-footer">
      <button class="btn btn-primary" id="closeUpdateLog">Отлично!</button>
      <button class="btn btn-secondary" id="downloadUpdateLogImage">
        <i class="fas fa-download"></i> Сохранить как изображение
      </button>
    </div>
  </div>
</div>

  <style>
    .update-log-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    
    .update-log-content {
      background-color: var(--panel-bg);
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
      animation: modalFadeIn 0.3s ease;
    }
    
    .update-log-header {
      padding: 15px 20px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 8px 8px 0 0;
    }
    
    .update-log-header h3 {
      margin: 0;
      font-size: 1.2rem;
    }
    
    .close-update-log {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
    }
    
    .update-log-body {
      padding: 20px;
    }
    
    .update-list {
      list-style-type: none;
    }
    
    .update-list li {
      margin-bottom: 10px;
      padding-left: 25px;
      position: relative;
    }
    
    .update-list li i {
      position: absolute;
      left: 0;
      top: 3px;
      color: var(--primary);
    }
    
    .update-log-footer {
      padding: 15px 20px;
      text-align: right;
      border-top: 1px solid var(--panel-border);
    }
    
    .inventory {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .inventory-slot {
      border: 1px solid var(--input-border);
      padding: 15px;
      border-radius: 6px;
      min-height: 80px;
      background-color: var(--input-bg);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    
    .inventory-slot.active {
      border: 2px solid var(--primary);
      background-color: var(--input-bg);
    }
    
    .inventory-slot::after {
      content: attr(data-slot);
      position: absolute;
      top: 5px;
      left: 5px;
      font-size: 0.7rem;
      color: var(--gray);
    }
    
    .slot-content {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .slot-img {
      width: 40px;
      height: 40px;
      object-fit: contain;
      margin-bottom: 5px;
    }
    /* Categories */
    
    .inventory-categories {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-bottom: 15px;
    }
    
    .category-btn {
      padding: 8px 12px;
      background-color: var(--input-bg);
      border: 1px solid var(--input-border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.2s;
    }
    
    .category-btn i {
      font-size: 0.8rem;
    }
    
    .category-btn.active {
      background-color: var(--primary);
      color: white;
      border-color: var(--primary-dark);
    }
    
    .subcategory-btn {
      padding: 6px 10px;
      background-color: var(--input-bg);
      border: 1px solid var(--input-border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.2s;
    }
    
    .subcategory-btn.active {
      background-color: var(--primary-light);
      color: var(--primary-dark);
      border-color: var(--primary);
    }
    /* Item list */
    
    .item-list-container {
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid var(--input-border);
      border-radius: 4px;
      padding: 5px;
    }
    
    .item-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 8px;
    }
    
    .item {
      padding: 10px;
      border: 1px solid var(--input-border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
      background-color: var(--input-bg);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .item:hover {
      background-color: var(--input-hover);
      transform: translateY(-2px);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      border-color: var(--primary);
    }
    
    .item-img {
      width: 50px;
      height: 50px;
      object-fit: contain;
      margin-bottom: 5px;
    }
    
    .item-name {
      font-weight: 500;
      margin-bottom: 3px;
      text-align: center;
    }
    
    .item-id {
      font-size: 0.8rem;
      color: var(--gray);
      text-align: center;
    }
    
    .server-icon {
      width: 16px;
      height: 16px;
      margin-right: 5px;
    }
    
    .inventory-categories {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-bottom: 15px;
    }
    
    .category-group {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      width: 100%;
      margin-bottom: 10px;
    }
    
    .category-btn {
      color: var(--text-color);
      padding: 8px 12px;
      background-color: var(--input-bg);
      border: 1px solid var(--input-border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.2s;
    }
    
    .category-btn i {
      font-size: 0.8rem;
    }
    
    .category-btn.active {
      background-color: var(--primary);
      color: white;
      border-color: var(--primary-dark);
    }
    
    .subcategory-group {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      width: 100%;
      margin-left: 20px;
      /* Отступ для подкатегорий */
      margin-bottom: 10px;
    }
    
    .subcategory-btn {
      color: var(--text-color);
      padding: 6px 10px;
      background-color: var(--input-bg);
      border: 1px solid var(--input-border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.2s;
    }
    
    .subcategory-btn.active {
      background-color: var(--primary-light);
      color: var(--primary-dark);
      border-color: var(--primary);
    }
    
    .server-icon {
      width: 16px;
      height: 16px;
      margin-right: 5px;
      vertical-align: middle;
    }
    
    @keyframes spin {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }
    .group-actions {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.group-actions .btn {
  flex: 1;
  min-width: 120px;
}

  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const currentVersion = '1.2.0'; // Обновлять при каждом новом релизе
      const lastSeenVersion = localStorage.getItem('lastSeenVersion');
      const updateModal = document.getElementById('updateLogModal');
      initRoleModal();
      if (lastSeenVersion !== currentVersion) {
        updateModal.style.display = 'flex';
        localStorage.setItem('lastSeenVersion', currentVersion);
      }
      document.getElementById('closeUpdateLog').addEventListener('click', function() {
        updateModal.style.display = 'none';
      });
      document.querySelector('.close-update-log').addEventListener('click', function() {
        updateModal.style.display = 'none';
      });
    });
    document.getElementById('downloadUpdateLogImage').addEventListener('click', function() {
  const updateLogContent = document.getElementById('updateLogContent');
  
  html2canvas(updateLogContent, {
    backgroundColor: null,
    scale: 2,
    logging: true,
    useCORS: true,
    allowTaint: true,
    letterRendering: true,

  }).then(canvas => {
    const link = document.createElement('a');
    link.download = 'update-log-v1.2.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
    showNotification('Апдейтлог сохранён как изображение!', 'success');
  }).catch(error => {
    console.error('Error saving update log:', error);
    showNotification('Ошибка при сохранении апдейтлога', 'error');
  });
});
  </script>
  <!-- прочий код -->


  <div class="container">
    <header>
      <h1><i class="fas fa-code"></i> CLscript Generator</h1>
      <p>Инструмент для создания скриптов персонажей в SCP: Secret Laboratory</p>
    </header>
    <div class="theme-switcher" style="display: flex; align-items: center; gap: 10px;">
  <div style="display: flex; align-items: center; gap: 10px;">
    <label>
      <i class="fas fa-moon"></i>
      <input type="checkbox" id="themeToggle">
      <i class="fas fa-sun"></i>
    </label>
  </div>
  
  <!-- Новая кнопка для апдейт лога -->
  <button id="updateLogButton" class="update-log-btn" title="История обновлений">
    <i class="fas fa-scroll"></i>
  </button>
</div>

<style>
  .update-log-btn {
    background: none;
    border: none;
    color: var(--text-color);
    font-size: 1.2rem;
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    transition: all 0.3s;
  }
  
  .update-log-btn:hover {
    background-color: rgba(0,0,0,0.1);
    transform: scale(1.1);
  }
  
  .update-log-btn:active {
    transform: scale(0.95);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Обработчик для кнопки апдейт лога
    document.getElementById('updateLogButton').addEventListener('click', function() {
      document.getElementById('updateLogModal').style.display = 'flex';
    });
    
    // Ваш существующий код для themeToggle
    const themeToggle = document.getElementById('themeToggle');
    if (localStorage.getItem('darkTheme') === 'enabled') {
      document.body.classList.add('dark-theme');
      themeToggle.checked = true;
    }
    
    themeToggle.addEventListener('change', function() {
      if (this.checked) {
        document.body.classList.add('dark-theme');
        localStorage.setItem('darkTheme', 'enabled');
      } else {
        document.body.classList.remove('dark-theme');
        localStorage.setItem('darkTheme', 'disabled');
      }
    });
  });
</script>
    <div class="role-info-group">
    <div class="role-info-antigroup">
      <div class="panel">
        <div class="panel-header">
          <i class="fas fa-file-export"></i> Экспорт
        </div>
        <div class="panel-body">
          <!-- В секции экспорта -->
          <div class="export-thumbnail-group">
            <div style="flex: 1;">
              <textarea id="exportOutput" class="form-control" readonly></textarea>
              <div class="btn-group">
                <button class="btn btn-primary" onclick="copyToClipboard()">
                  <i class="fas fa-copy"></i> Копировать CLscript
                </button>
        <button class="btn btn-secondary" onclick="saveScriptToGroup()">
            <i class="fas fa-save"></i> Сохранить в текущую группу
          </button>
              </div>
              <div class="import-container">
                <label for="importInput">Импорт CLscript:</label>
                <textarea id="importInput" class="form-control" placeholder="Вставьте CLscript для импорта"></textarea>
                <button class="btn btn-secondary import-btn" onclick="importCLscript()">
                  <i class="fas fa-file-import"></i> Импортировать
                </button>
                <div id="importError" class="error-message"></div>
              </div>
            </div>
          </div></div>
        </div>
        <div class="panel" style="
    width: 582px;
">
  <div class="panel-header">
    <i class="fas fa-folder"></i> Группы
  </div>
  <div class="panel-body">
    <div class="groups-container">
      <div class="group-list" id="groupList">
        <!-- Groups will be added here dynamically -->
      </div>
<div class="group-actions">
  <button class="btn btn-primary" onclick="createNewGroup()">
    <i class="fas fa-plus"></i> Создать группу
  </button>
  <button class="btn btn-secondary" onclick="exportGroup()" style="margin-left: 10px;">
    <i class="fas fa-file-export"></i> Экспорт группы
  </button>
  <button class="btn btn-primary" onclick="importGroup()" style="margin-left: 10px;">
    <i class="fas fa-file-import"></i> Импорт группы
  </button>
</div>
      <div class="group-scripts" id="groupScriptsPanel" style="display: none;">
        <h4><i class="fas fa-file-code"></i> Скрипты в группе</h4>
        <div class="group-scripts-list" id="groupScriptsList">
          <!-- Scripts in selected group will be shown here -->
        </div>
<div class="group-script-actions">
  <button class="btn btn-primary" onclick="addScriptToGroup()">
    <i class="fas fa-plus"></i> Добавить скрипт
  </button>
  <button class="btn btn-primary" onclick="copyAllGroupScripts()">
    <i class="fas fa-copy"></i> Копировать все
  </button>
  <button class="btn btn-secondary" onclick="clearGroupScripts()">
    <i class="fas fa-trash"></i> Очистить группу
  </button>
  <button class="btn btn-secondary" onclick="deleteCurrentGroup()">
    <i class="fas fa-trash-alt"></i> Удалить группу
  </button>
  <button class="btn btn-primary" onclick="editCurrentGroup()">
    <i class="fas fa-cog"></i> Настройки группы
  </button>
</div>
      </div>
    </div>
  </div>

<script>
    // Groups functionality
let groups = JSON.parse(localStorage.getItem('clscriptGroups')) || [];
let currentGroupId = null;

function initGroups() {
  renderGroupList();
}

function renderGroupList() {
  const groupList = document.getElementById('groupList');
  groupList.innerHTML = '';
  
  if (groups.length === 0) {
    groupList.innerHTML = '<div class="no-groups">Нет созданных групп</div>';
    return;
  }
  
  groups.forEach(group => {
    const groupElement = document.createElement('div');
    groupElement.className = 'group-item';
    groupElement.dataset.id = group.id;
    groupElement.innerHTML = `
      <i class="fas ${group.icon || 'fa-folder'}"></i>
      <span>${group.name}</span>
      <span class="group-script-count">(${group.scripts.length})</span>
    `;
    
    groupElement.addEventListener('click', () => selectGroup(group.id));
    groupList.appendChild(groupElement);
  });
}

async function editCurrentGroup() {
  if (!currentGroupId) {
    showNotification('Пожалуйста, выберите группу', 'error');
    return;
  }
  
  const group = groups.find(g => g.id === currentGroupId);
  const result = await showGroupSettingsModal(group.name, group.icon);
  
  if (result) {
    group.name = result.name;
    group.icon = result.icon;
    saveGroups();
    renderGroupList();
    selectGroup(currentGroupId);
    showNotification('Группа успешно обновлена', 'success');
  }
}
async function createNewGroup() {
  // Создаем модальное окно для ввода названия группы и выбора иконки
  const result = await showGroupCreationModal();
  if (!result) return;

  const newGroup = {
    id: Date.now().toString(),
    name: result.groupName,
    icon: result.groupIcon || 'fa-folder',
    scripts: []
  };
  
  groups.push(newGroup);
  saveGroups();
  renderGroupList();
  selectGroup(newGroup.id);
  
  showNotification('Группа успешно создана', 'success');
}

// Функция для показа модального окна создания группы
async function showGroupCreationModal() {
  return new Promise((resolve) => {
    const modal = document.createElement('div');
    modal.className = 'notification-modal';
    modal.style.display = 'flex';
    
    // Список популярных иконок для групп
    const popularIcons = [
      'fa-folder', 'fa-folder-open', 'fa-box', 'fa-archive',
      'fa-book', 'fa-bookmark', 'fa-tags', 'fa-list',
      'fa-layer-group', 'fa-object-group'
    ];
    
    modal.innerHTML = `
      <div class="notification-content" style="max-width: 500px;">
        <div class="notification-header">
          <h3><i class="fas fa-plus-circle"></i> Создание группы</h3>
          <span class="close-modal">&times;</span>
        </div>
        <div class="notification-body">
          <div class="form-group">
            <label for="groupNameInput">Название группы:</label>
            <input type="text" id="groupNameInput" class="form-control" placeholder="Введите название группы">
          </div>
          
          <div class="form-group" style="margin-top: 20px;">
            <label>Выберите иконку:</label>
            <div class="icon-grid">
              ${popularIcons.map(icon => `
                <button class="icon-btn" data-icon="${icon}">
                  <i class="fas ${icon}"></i>
                </button>
              `).join('')}
            </div>
            <div style="margin-top: 10px;">
              <small>Или введите класс Font Awesome вручную:</small>
              <input type="text" id="customIconInput" class="form-control" placeholder="fa-icon-name">
            </div>
          </div>
        </div>
        <div class="notification-footer">
          <button class="btn btn-secondary" id="modalCancel">Отмена</button>
          <button class="btn btn-primary" id="modalConfirm">Создать</button>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    // Добавляем стили для сетки иконок
    const style = document.createElement('style');
    style.textContent = `
      .icon-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 10px;
        margin-top: 10px;
      }
      .icon-btn {
        color: var(--text-color);
        padding: 10px;
        border: 1px solid var(--input-border);
        background-color: var(--input-bg);
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 40px;
      }
      .icon-btn:hover {
        background-color: var(--primary-light);
        border-color: var(--primary);
      }
      .icon-btn.selected {
        background-color: var(--primary);
        color: white;
        border-color: var(--primary-dark);
      }
    `;
    document.head.appendChild(style);
    
    const groupNameInput = modal.querySelector('#groupNameInput');
    const customIconInput = modal.querySelector('#customIconInput');
    let selectedIcon = 'fa-folder';
    
    // Выбираем иконку по клику
    modal.querySelectorAll('.icon-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        modal.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        selectedIcon = btn.dataset.icon;
        customIconInput.value = '';
      });
    });
    
    // Обработка ручного ввода иконки
    customIconInput.addEventListener('input', () => {
      if (customIconInput.value) {
        modal.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('selected'));
        selectedIcon = customIconInput.value;
      }
    });
    
    const closeModal = (result = null) => {
      modal.remove();
      style.remove();
      resolve(result);
    };
    
    modal.querySelector('#modalConfirm').addEventListener('click', () => {
      const groupName = groupNameInput.value.trim();
      if (!groupName) {
        showNotification('Пожалуйста, введите название группы', 'error');
        return;
      }
      
      closeModal({
        groupName,
        groupIcon: selectedIcon
      });
    });
    
    modal.querySelector('#modalCancel').addEventListener('click', () => {
      closeModal();
    });
    
    modal.querySelector('.close-modal').addEventListener('click', () => {
      closeModal();
    });
    
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });
    
    // Фокус на поле ввода названия
    groupNameInput.focus();
  });
}

// Функция для показа модального окна создания группы
async function showGroupSettingsModal(currentName, currentIcon) {
  return new Promise((resolve) => {
    const modal = document.createElement('div');
    modal.className = 'notification-modal';
    modal.style.display = 'flex';
    
    // Список популярных иконок для групп
    const popularIcons = [
      'fa-folder', 'fa-folder-open', 'fa-box', 'fa-archive',
      'fa-book', 'fa-bookmark', 'fa-tags', 'fa-list',
      'fa-layer-group', 'fa-object-group'
    ];
    
    modal.innerHTML = `
      <div class="notification-content" style="max-width: 500px;">
        <div class="notification-header">
          <h3><i class="fas fa-cog"></i> Настройки группы</h3>
          <span class="close-modal">&times;</span>
        </div>
        <div class="notification-body">
          <div class="form-group">
            <label for="groupNameInput">Название группы:</label>
            <input type="text" id="groupNameInput" class="form-control" value="${currentName}">
          </div>
          
          <div class="form-group" style="margin-top: 20px;">
            <label>Выберите иконку:</label>
            <div class="icon-grid">
              ${popularIcons.map(icon => `
                <button class="icon-btn ${icon === currentIcon ? 'selected' : ''}" data-icon="${icon}">
                  <i class="fas ${icon}"></i>
                </button>
              `).join('')}
            </div>
            <div style="margin-top: 10px;">
              <small>Или введите класс Font Awesome вручную:</small>
              <input type="text" id="customIconInput" class="form-control" placeholder="fa-icon-name" value="${!popularIcons.includes(currentIcon) ? currentIcon : ''}">
            </div>
          </div>
        </div>
        <div class="notification-footer">
          <button class="btn btn-secondary" id="modalCancel">Отмена</button>
          <button class="btn btn-primary" id="modalConfirm">Сохранить</button>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    // Добавляем стили для сетки иконок
    const style = document.createElement('style');
    style.textContent = `
      .icon-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 10px;
        margin-top: 10px;
      }
      .icon-btn {
        padding: 10px;
        border: 1px solid var(--input-border);
        background-color: var(--input-bg);
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 40px;
      }
      .icon-btn:hover {
        background-color: var(--primary-light);
        border-color: var(--primary);
      }
      .icon-btn.selected {
        background-color: var(--primary);
        color: white;
        border-color: var(--primary-dark);
      }
    `;
    document.head.appendChild(style);
    
    const groupNameInput = modal.querySelector('#groupNameInput');
    const customIconInput = modal.querySelector('#customIconInput');
    let selectedIcon = currentIcon;
    
    // Выбираем иконку по клику
    modal.querySelectorAll('.icon-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        modal.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        selectedIcon = btn.dataset.icon;
        customIconInput.value = '';
      });
    });
    
    // Обработка ручного ввода иконки
    customIconInput.addEventListener('input', () => {
      if (customIconInput.value) {
        modal.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('selected'));
        selectedIcon = customIconInput.value;
      }
    });
    
    const closeModal = (result = null) => {
      modal.remove();
      style.remove();
      resolve(result);
    };
    
    modal.querySelector('#modalConfirm').addEventListener('click', () => {
      const groupName = groupNameInput.value.trim();
      if (!groupName) {
        showNotification('Пожалуйста, введите название группы', 'error');
        return;
      }
      
      closeModal({
        name: groupName,
        icon: selectedIcon
      });
    });
    
    modal.querySelector('#modalCancel').addEventListener('click', () => {
      closeModal();
    });
    
    modal.querySelector('.close-modal').addEventListener('click', () => {
      closeModal();
    });
    
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });
  });
}

// Добавьте эту функцию для показа модального окна с полем ввода
async function showInputModal(title, message, inputType = 'text', defaultValue = '') {
  return new Promise((resolve) => {
    const modal = document.createElement('div');
    modal.className = 'notification-modal';
    modal.style.display = 'flex';
    modal.innerHTML = `
      <div class="notification-content">
        <div class="notification-header">
          <h3><i class="fas fa-edit"></i> ${title}</h3>
          <span class="close-modal">&times;</span>
        </div>
        <div class="notification-body">
          <p>${message}</p>
          <input type="${inputType}" id="modalInput" class="form-control" value="${defaultValue}" style="margin-top: 10px;">
        </div>
        <div class="notification-footer">
          <button class="btn btn-secondary" id="modalCancel">Отмена</button>
          <button class="btn btn-primary" id="modalConfirm">OK</button>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    const inputField = modal.querySelector('#modalInput');
    inputField.focus();
    
    const closeModal = (value = null) => {
      modal.remove();
      resolve(value);
    };
    
    modal.querySelector('#modalConfirm').addEventListener('click', () => {
      closeModal(inputField.value.trim());
    });
    
    modal.querySelector('#modalCancel').addEventListener('click', () => {
      closeModal();
    });
    
    modal.querySelector('.close-modal').addEventListener('click', () => {
      closeModal();
    });
    
    inputField.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        closeModal(inputField.value.trim());
      }
    });
    
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });
  });
}

function selectGroup(groupId) {
  currentGroupId = groupId;
  const group = groups.find(g => g.id === groupId);
  
  // Highlight selected group
  document.querySelectorAll('.group-item').forEach(item => {
    item.classList.toggle('active', item.dataset.id === groupId);
  });
  
  // Show group scripts panel
  document.getElementById('groupScriptsPanel').style.display = 'block';
  
  // Render scripts in group
  const scriptsList = document.getElementById('groupScriptsList');
  scriptsList.innerHTML = '';
  
  if (group.scripts.length === 0) {
    scriptsList.innerHTML = '<div class="no-scripts">Нет скриптов в этой группе</div>';
    return;
  }
  
  group.scripts.forEach((script, index) => {
    const scriptName = script.name || `Скрипт ${index + 1}`;
    const scriptElement = document.createElement('div');
    scriptElement.className = 'group-script-item';
    scriptElement.innerHTML = `
      <div class="script-info">
        <span class="script-name">${scriptName}</span>
        <span class="script-preview">${script.content.substring(0, 50)}...</span>
      </div>
      <div class="script-actions">
        <button class="btn btn-sm btn-outline" onclick="copyGroupScript('${groupId}', ${index})" title="Копировать">
          <i class="fas fa-copy"></i>
        </button>
        <button class="btn btn-sm btn-outline" onclick="importGroupScript('${groupId}', ${index})" title="Импортировать">
          <i class="fas fa-file-import"></i>
        </button>
        <button class="btn btn-sm btn-outline" onclick="editGroupScript('${groupId}', ${index})" title="Настройки">
          <i class="fas fa-cog"></i>
        </button>
        <button class="btn btn-sm btn-outline" onclick="removeScriptFromGroup('${groupId}', ${index})" title="Удалить">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    `;
    scriptsList.appendChild(scriptElement);
  });
}

async function saveScriptToGroup() {
  if (!currentGroupId) {
    showNotification('Пожалуйста, выберите группу сначала', 'error');
    return;
  }
  
  const scriptContent = document.getElementById('exportOutput').value;
  if (!scriptContent) {
    showNotification('Нет скрипта для сохранения', 'error');
    return;
  }
  
  // Запрашиваем название для нового скрипта
  const scriptName = await showInputModal(
    'Сохранение скрипта',
    'Введите название для скрипта:',
    'text',
    'Новый скрипт'
  );
  
  if (!scriptName) return;
  
  const group = groups.find(g => g.id === currentGroupId);
  group.scripts.push({
    name: scriptName,
    content: scriptContent
  });
  saveGroups();
  selectGroup(currentGroupId);
  
  showNotification('Скрипт успешно сохранен в группу', 'success');
}

async function addScriptToGroup() {
  if (!currentGroupId) {
    showNotification('Пожалуйста, выберите группу сначала', 'error');
    return;
  }
  
  const result = await showScriptSettingsModal(
    'Новый скрипт',
    'clscript '
  );
  
  if (result) {
    if (!result.content.startsWith('clscript ')) {
      showNotification('Неверный формат CLscript', 'error');
      return;
    }
    
    const group = groups.find(g => g.id === currentGroupId);
    group.scripts.push({
      name: result.name,
      content: result.content
    });
    saveGroups();
    selectGroup(currentGroupId);
    
    showNotification('Скрипт успешно добавлен в группу', 'success');
  }
}
function importGroupScript(groupId, scriptIndex) {
  const group = groups.find(g => g.id === groupId);
  const script = group.scripts[scriptIndex];
  
  // Убедитесь, что передаёте script.content, а не script
  importCLscriptFromString(script.content);
  
  showNotification('Скрипт успешно импортирован', 'success');
}
function importCLscriptFromString(scriptString) {
  const importInput = document.getElementById('importInput');
  importInput.value = scriptString;
  importCLscript();
}
async function editGroupScript(groupId, scriptIndex) {
  const group = groups.find(g => g.id === groupId);
  const script = group.scripts[scriptIndex];
  
  const result = await showScriptSettingsModal(
    script.name || `Скрипт ${scriptIndex + 1}`,
    script.content
  );
  
  if (result) {
    script.name = result.name;
    script.content = result.content;
    saveGroups();
    selectGroup(groupId);
    showNotification('Скрипт успешно обновлен', 'success');
  }
}
async function showScriptSettingsModal(currentName, currentContent) {
  return new Promise((resolve) => {
    const modal = document.createElement('div');
    modal.className = 'notification-modal';
    modal.style.display = 'flex';
    
    modal.innerHTML = `
      <div class="notification-content" style="max-width: 600px;">
        <div class="notification-header">
          <h3><i class="fas fa-cog"></i> Настройки скрипта</h3>
          <span class="close-modal">&times;</span>
        </div>
        <div class="notification-body">
          <div class="form-group">
            <label for="scriptNameInput">Название скрипта:</label>
            <input type="text" id="scriptNameInput" class="form-control" value="${currentName}">
          </div>
          <div class="form-group">
            <label for="scriptContentInput">Содержимое CLscript:</label>
            <textarea id="scriptContentInput" class="form-control" rows="6">${currentContent}</textarea>
          </div>
        </div>
        <div class="notification-footer">
          <button class="btn btn-secondary" id="modalCancel">Отмена</button>
          <button class="btn btn-primary" id="modalConfirm">Сохранить</button>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    const closeModal = (result = null) => {
      modal.remove();
      resolve(result);
    };
    
    modal.querySelector('#modalConfirm').addEventListener('click', () => {
      const name = modal.querySelector('#scriptNameInput').value.trim();
      const content = modal.querySelector('#scriptContentInput').value.trim();
      
      if (!name) {
        showNotification('Пожалуйста, введите название скрипта', 'error');
        return;
      }
      
      if (!content.startsWith('clscript ')) {
        showNotification('Неверный формат CLscript', 'error');
        return;
      }
      
      closeModal({name, content});
    });
    
    modal.querySelector('#modalCancel').addEventListener('click', () => {
      closeModal();
    });
    
    modal.querySelector('.close-modal').addEventListener('click', () => {
      closeModal();
    });
    
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });
  });
}
function copyGroupScript(groupId, scriptIndex) {
  const group = groups.find(g => g.id === groupId);
  const script = group.scripts[scriptIndex];
  
  navigator.clipboard.writeText(script.content).then(() => { // Копируем content вместо всего объекта
    showNotification('Скрипт скопирован', 'success');
  });
}

function copyAllGroupScripts() {
  const group = groups.find(g => g.id === currentGroupId);
  const allScripts = group.scripts.map(script => script.content).join('\n\n'); // Сначала извлекаем content
  
  navigator.clipboard.writeText(allScripts).then(() => {
    showNotification('Все скрипты скопированы', 'success');
  });
}
function showToastNotification(message, type = 'success') {
  const toast = document.createElement('div');
  toast.className = `toast-notification ${type}`;
  
  let icon;
  switch(type) {
    case 'success':
      icon = 'fa-check-circle';
      break;
    case 'error':
      icon = 'fa-times-circle';
      break;
    case 'warning':
      icon = 'fa-exclamation-triangle';
      break;
    case 'info':
      icon = 'fa-info-circle';
      break;
    default:
      icon = 'fa-check-circle';
  }
  
  toast.innerHTML = `
    <div class="toast-icon">
      <i class="fas ${icon}"></i>
    </div>
    <div class="toast-message">${message}</div>
    <div class="toast-close">
      <i class="fas fa-times"></i>
    </div>
  `;
  
  document.body.appendChild(toast);
  
  // Показываем уведомление
  setTimeout(() => {
    toast.classList.add('show');
  }, 10);
  
  // Закрытие по клику на крестик
  toast.querySelector('.toast-close').addEventListener('click', () => {
    closeToast(toast);
  });
  
  // Автоматическое закрытие через 3 секунды
  const autoClose = setTimeout(() => {
    closeToast(toast);
  }, 3000);
  
  function closeToast(element) {
    element.classList.remove('show');
    setTimeout(() => {
      element.remove();
    }, 300);
    clearTimeout(autoClose);
  }
}
function removeScriptFromGroup(groupId, scriptIndex) {
  
  showNotification('Скрипт удалён', 'success');
  const group = groups.find(g => g.id === groupId);
  group.scripts.splice(scriptIndex, 1);
  saveGroups();
  selectGroup(groupId);
}

async function clearGroupScripts() {
  const confirmed = await confirmAction('Очистить все скрипты в этой группе?');
  if (!confirmed) return;
  
  const group = groups.find(g => g.id === currentGroupId);
  group.scripts = [];
  saveGroups();
  selectGroup(currentGroupId);
  
  showNotification('Все скрипты в группе очищены', 'success');
}

async function deleteCurrentGroup() {
  
  groups = groups.filter(g => g.id !== currentGroupId);
  saveGroups();
  currentGroupId = null;
  document.getElementById('groupScriptsPanel').style.display = 'none';
  renderGroupList();
  
  showNotification('Группа успешно удалена', 'success');
}

// Добавьте эту функцию для подтверждения действий
async function confirmAction(message) {
  return new Promise((resolve) => {
    const modal = document.createElement('div');
    modal.className = 'notification-modal';
    modal.style.display = 'flex';
    modal.innerHTML = `
      <div class="notification-content notification-warning">
        <div class="notification-header">
          <h3><i class="fas fa-exclamation-triangle"></i> Подтверждение</h3>
          <span class="close-modal">&times;</span>
        </div>
        <div class="notification-body">
          <div class="notification-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <p>${message}</p>
        </div>
        <div class="notification-footer">
          <button class="btn btn-secondary" id="modalCancel">Отмена</button>
          <button class="btn btn-danger" id="modalConfirm">Подтвердить</button>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    const closeModal = (result) => {
      modal.remove();
      resolve(result);
    };
    
    modal.querySelector('#modalConfirm').addEventListener('click', () => {
      closeModal(true);
    });
    
    modal.querySelector('#modalCancel').addEventListener('click', () => {
      closeModal(false);
    });
    
    modal.querySelector('.close-modal').addEventListener('click', () => {
      closeModal(false);
    });
    
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal(false);
      }
    });
  });
}

function deleteCurrentGroup() {
  
  groups = groups.filter(g => g.id !== currentGroupId);
  saveGroups();
  currentGroupId = null;
  document.getElementById('groupScriptsPanel').style.display = 'none';
  renderGroupList();
}

function saveGroups() {
  localStorage.setItem('clscriptGroups', JSON.stringify(groups));
}

// Initialize groups when DOM is loaded
document.addEventListener('DOMContentLoaded', initGroups);
</script>

      </div>
      </div>
      <div class="panel">
        <div class="panel-header">
          <i class="fas fa-file-export"></i> Миниатюра
        </div>
        <div class="panel-body">

          <!-- Блок миниатюры с кнопками под ней -->
          <div class="thumbnail-wrapper">
            <div class="thumbnail-container" id="thumbnailPreview">
              <img id="thumbnailRoleImage" class="thumbnail-role-image" src="assets/items/350px-Capybara956.png">
              <div class="thumbnail-description-overlay" id="thumbnailDescription">
                Описание отсутствует
              </div>
              <div class="thumbnail-items-grid" id="thumbnailItemsGrid">
                <!-- Сетка предметов будет заполнена скриптом -->
              </div>
            </div>
            <div class="thumbnail-actions">
              <button class="btn btn-primary" onclick="saveThumbnail()">
                <i class="fas fa-download"></i> Сохранить миниатюру
              </button>
              <button class="btn btn-secondary" onclick="copyThumbnailToClipboard()">
                <i class="fas fa-copy"></i> Копировать миниатюру
              </button>

            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-header">
        <i class="fas fa-cog"></i> Основные параметры
      </div>
      <div class="panel-body">
        <div class="form-group">
          <label for="playerID">ID игрока:</label>
          <input type="text" id="playerID" class="form-control" placeholder="SteamID, внутриигровой ID или ник">
        </div>

        <div class="form-group">
          <label for="nickname">НикНэйм:</label>
          <input type="text" id="nickname" class="form-control" placeholder="Серверное имя игрока">
        </div>

        <div class="slider-container">
          <label for="hpSlider">HP (Здоровье):</label>
          <input type="range" id="hpSlider" min="1" max="1000" value="100">
          <span id="hpValue" class="slider-value">100</span>
          <input type="number" id="hpInput" class="form-control" style="width: 80px; margin-left: 10px;" min="1" max="1000" value="100">
        </div>
      </div>
    </div>

    <div class="role-info-group">
      <div class="panel">
        <div class="panel-header">
          <i class="fas fa-info-circle"></i> Инфополя
        </div>
        <div class="panel-body">
          <div class="checkbox-group">
            <div class="checkbox-item">
              <input type="checkbox" id="nicknameCheckbox" checked>
              <label for="nicknameCheckbox">Никнэйм</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="badgeCheckbox">
              <label for="badgeCheckbox">Плашка</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="customInfoCheckbox">
              <label for="customInfoCheckbox">Кастом-инфо</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="roleCheckbox">
              <label for="roleCheckbox">Роль</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="unitNameCheckbox">
              <label for="unitNameCheckbox">Номер отряда</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="powerStatusCheckbox">
              <label for="powerStatusCheckbox">Ранг</label>
            </div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <i class="fas fa-user-tag"></i> Роль
        </div>
        <div class="panel-body">
          <input type="hidden" id="roleSelect" value="">
          <div class="role-preview-card" id="rolePreviewCard">
            <div class="role-preview-content" id="rolePreviewContent">
              <div class="role-preview-icon">
                <i class="fas fa-user-plus"></i>
              </div>
              <div class="role-preview-placeholder">Выберите роль</div>
            </div>
          </div>
        </div>
      </div>
      <div class="panel">
        <!-- Убрал класс ammo-panel -->
        <div class="panel-header">
          <i class="fas fa-bullseye"></i> Патроны
        </div>
        <div class="panel-body">
          <div class="slider-container-wrapper">
            <div>
              <div class="slider-container">
                <label for="ammo556Slider">5.56x45:</label>
                <input type="range" id="ammo556Slider" min="0" max="500" value="0">
                <span id="ammo556Value" class="slider-value">0</span>
                <input type="number" id="ammo556Input" class="form-control" style="width: 80px; margin-left: 10px;" min="0" max="500" value="0">
              </div>
              <div class="slider-container">
                <label for="ammo762Slider">7.62x39:</label>
                <input type="range" id="ammo762Slider" min="0" max="500" value="0">
                <span id="ammo762Value" class="slider-value">0</span>
                <input type="number" id="ammo762Input" class="form-control" style="width: 80px; margin-left: 10px;" min="0" max="500" value="0">
              </div>
            </div>
            <div>
              <div class="slider-container">
                <label for="ammo9Slider">9x19:</label>
                <input type="range" id="ammo9Slider" min="0" max="500" value="0">
                <span id="ammo9Value" class="slider-value">0</span>
                <input type="number" id="ammo9Input" class="form-control" style="width: 80px; margin-left: 10px;" min="0" max="500" value="0">
              </div>
              <div class="slider-container">
                <label for="ammo12Slider">12 калибр:</label>
                <input type="range" id="ammo12Slider" min="0" max="500" value="0">
                <span id="ammo12Value" class="slider-value">0</span>
                <input type="number" id="ammo12Input" class="form-control" style="width: 80px; margin-left: 10px;" min="0" max="500" value="0">
              </div>
            </div>
            <div>
              <div class="slider-container">
                <label for="ammo44Slider">44 калибр:</label>
                <input type="range" id="ammo44Slider" min="0" max="500" value="0">
                <span id="ammo44Value" class="slider-value">0</span>
                <input type="number" id="ammo44Input" class="form-control" style="width: 80px; margin-left: 10px;" min="0" max="500" value="0">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-header">
        <i class="fas fa-align-left"></i> Описание
      </div>
      <div class="panel-body">
        <div class="format-buttons">
          <button class="format-btn" onclick="insertTag('b')"><i class="fas fa-bold"></i> Жирный</button>
          <button class="format-btn" onclick="insertTag('i')"><i class="fas fa-italic"></i> Курсив</button>
          <button class="format-btn" onclick="insertTag('size')"><i class="fas fa-text-height"></i> Размер</button>
          <input type="number" id="sizeInput" class="size-input" min="10" max="50" value="20" placeholder="Размер">
          <button class="format-btn" onclick="insertTag('\\n')"><i class="fas fa-arrow-down"></i> Новая строка</button>
        </div>
        <!-- Код палитры + подсказки к ней -->
        <div class="color-palette">
          <div class="color-option" style="background-color: #FF96DE;" onclick="insertColor('#FF96DE')" data-color-name="Pink" data-color-code="#FF96DE"></div>
          <div class="color-option" style="background-color: #FF0090;" onclick="insertColor('#FF0090')" data-color-name="Magenta" data-color-code="#FF0090"></div>
          <div class="color-option" style="background-color: #FF1493;" onclick="insertColor('#FF1493')" data-color-name="Deep Pink" data-color-code="#FF1493"></div>
          <div class="color-option" style="background-color: #C50000;" onclick="insertColor('#C50000')" data-color-name="Red" data-color-code="#C50000"></div>
          <div class="color-option" style="background-color: #228B22;" onclick="insertColor('#228B22')" data-color-name="Forest Green" data-color-code="#228B22"></div>
          <div class="color-option" style="background-color: #A0A0A0;" onclick="insertColor('#A0A0A0')" data-color-name="Silver" data-color-code="#A0A0A0"></div>
          <div class="color-option" style="background-color: #98FB98;" onclick="insertColor('#98FB98')" data-color-name="Pale Green" data-color-code="#98FB98"></div>
          <div class="color-option" style="background-color: #4DFFB8;" onclick="insertColor('#4DFFB8')" data-color-name="Aquamarine" data-color-code="#4DFFB8"></div>
          <div class="color-option" style="background-color: #FF6448;" onclick="insertColor('#FF6448')" data-color-name="Tomato" data-color-code="#FF6448"></div>
          <div class="color-option" style="background-color: #DC143C;" onclick="insertColor('#DC143C')" data-color-name="Crimson" data-color-code="#DC143C"></div>
          <div class="color-option" style="background-color: #50C878;" onclick="insertColor('#50C878')" data-color-name="Emerald" data-color-code="#50C878"></div>
          <div class="color-option" style="background-color: #4B5320;" onclick="insertColor('#4B5320')" data-color-name="Army Green" data-color-code="#4B5320"></div>
          <div class="color-option" style="background-color: #00FFFF;" onclick="insertColor('#00FFFF')" data-color-name="Cyan" data-color-code="#00FFFF"></div>
          <div class="color-option" style="background-color: #FF9966;" onclick="insertColor('#FF9966')" data-color-name="Orange" data-color-code="#FF9966"></div>
          <div class="color-option" style="background-color: #FAFF86;" onclick="insertColor('#FAFF86')" data-color-name="Yellow" data-color-code="#FAFF86"></div>
          <div class="color-option" style="background-color: #00B7EB;" onclick="insertColor('#00B7EB')" data-color-name="Vivid Sky Blue" data-color-code="#00B7EB"></div>
          <div class="color-option" style="background-color: #960018;" onclick="insertColor('#960018')" data-color-name="Carmine" data-color-code="#960018"></div>
          <div class="color-option" style="background-color: #EE7600;" onclick="insertColor('#EE7600')" data-color-name="Pumpkin" data-color-code="#EE7600"></div>
          <div class="color-option" style="background-color: #32CD32;" onclick="insertColor('#32CD32')" data-color-name="Lime Green" data-color-code="#32CD32"></div>
          <div class="color-option" style="background-color: #BFFF00;" onclick="insertColor('#BFFF00')" data-color-name="Chartreuse" data-color-code="#BFFF00"></div>
          <div class="color-option" style="background-color: #FFFFFF;" onclick="insertColor('#FFFFFF')" data-color-name="White" data-color-code="#FFFFFF"></div>
          <div class="color-option" style="background-color: #000000;" onclick="insertColor('#000000')" data-color-name="Black" data-color-code="#000000"></div>
          <div class="color-option" style="background-color: #727472;" onclick="insertColor('#727472')" data-color-name="Nickel" data-color-code="#727472"></div>
          <div class="color-option" style="background-color: #944710;" onclick="insertColor('#944710')" data-color-name="Umber" data-color-code="#944710"></div>
        </div>
        <style>
          /* Обновлённые стили для подсказок */
          
          .color-option {
            position: relative;
          }
          
          .color-option .color-tooltip {
            position: absolute;
            bottom: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%);
            background-color: inherit;
            color: #333;
            padding: 8px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
            pointer-events: none;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
            min-width: 80px;
            line-height: 1.4;
          }
          /* Специальные стили для чёрного и белого */
          
          .color-option[style*="#000000"] .color-tooltip,
          .color-option[style*="#FFFFFF"] .color-tooltip {
            background-color: var(--dark-light);
            color: white;
          }
          
          .color-option[style*="#000000"] .color-tooltip::before,
          .color-option[style*="#FFFFFF"] .color-tooltip::before {
            border-top-color: var(--dark-light);
          }
          
          .color-option:hover .color-tooltip {
            opacity: 1;
            visibility: visible;
            bottom: calc(100% + 8px);
          }
          
          .color-option .color-tooltip::before {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid inherit;
          }
          
          .color-option .color-code {
            font-weight: bold;
            display: block;
          }
          
          .color-option .color-name {
            font-size: 11px;
            display: block;
          }
        </style>

        <script>
          // Добавьте этот код в ваш скрипт
          document.addEventListener('DOMContentLoaded', function() {
            // Создаем подсказки для всех цветов
            document.querySelectorAll('.color-option').forEach(color => {
              const colorCode = color.getAttribute('data-color-code');
              const colorName = color.getAttribute('data-color-name');
              const tooltip = document.createElement('div');
              tooltip.className = 'color-tooltip';
              tooltip.style.backgroundColor = colorCode;
              tooltip.innerHTML = `
                <span class="color-code">${colorCode}</span>
                <span class="color-name">${colorName}</span>
            `;
              // Особые условия для чёрного и белого
              if (colorCode === '#000000' || colorCode === '#FFFFFF') {
                tooltip.style.color = '#fff';
                if (colorCode === '#FFFFFF') {
                  tooltip.style.color = '#333';
                }
              } else {
                // Автоматическое определение цвета текста (светлый/тёмный)
                const hex = colorCode.replace('#', '');
                const r = parseInt(hex.substr(0, 2), 16);
                const g = parseInt(hex.substr(2, 2), 16);
                const b = parseInt(hex.substr(4, 2), 16);
                const brightness = (r * 299 + g * 587 + b * 114) / 1000;
                tooltip.style.color = brightness > 128 ? '#333' : '#fff';
              }
              color.appendChild(tooltip);
            });
          });
          function exportGroup() {
  if (!currentGroupId) {
    showNotification('Пожалуйста, выберите группу сначала', 'error');
    return;
  }

  const group = groups.find(g => g.id === currentGroupId);
  let exportText = `Название группы: ${group.name}\n`;
  exportText += `Иконка: ${group.icon}\n\n`;

  group.scripts.forEach(script => {
    exportText += `Название скрипта: ${script.name}\n`;
    exportText += `Скрипт: ${script.content}\n\n`;
  });

  // Создаем Blob с текстом
  const blob = new Blob([exportText], {type: 'text/plain'});
  const url = URL.createObjectURL(blob);
  
  // Создаем ссылку для скачивания
  const a = document.createElement('a');
  a.href = url;
  a.download = `${group.name.replace(/[^a-z0-9]/gi, '_')}_group.txt`;
  document.body.appendChild(a);
  a.click();
  
  // Очищаем
  setTimeout(() => {
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }, 100);

  showNotification('Группа успешно экспортирована', 'success');
}

function importGroup() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.txt';

  input.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = async (event) => {
      try {
        const content = event.target.result;
        const lines = content.split('\n');
        
        let groupName = '';
        let groupIcon = 'fa-folder';
        const scripts = [];
        let currentScript = null;

        for (const line of lines) {
          if (line.startsWith('Название группы:')) {
            groupName = line.replace('Название группы:', '').trim();
          } else if (line.startsWith('Иконка:')) {
            groupIcon = line.replace('Иконка:', '').trim();
          } else if (line.startsWith('Название скрипта:')) {
            if (currentScript) {
              scripts.push(currentScript);
            }
            currentScript = {
              name: line.replace('Название скрипта:', '').trim(),
              content: ''
            };
          } else if (line.startsWith('Скрипт:')) {
            if (currentScript) {
              currentScript.content = line.replace('Скрипт:', '').trim();
            }
          } else if (currentScript && currentScript.content) {
            // Добавляем остальные строки скрипта (для многострочных скриптов)
            currentScript.content += '\n' + line.trim();
          }
        }

        if (currentScript) {
          scripts.push(currentScript);
        }

        if (!groupName) {
          showNotification('Неверный формат файла: не найдено название группы', 'error');
          return;
        }

        // Создаем новую группу
        const newGroup = {
          id: Date.now().toString(),
          name: groupName,
          icon: groupIcon || 'fa-folder',
          scripts: scripts.filter(s => s.name && s.content)
        };

        groups.push(newGroup);
        saveGroups();
        renderGroupList();
        selectGroup(newGroup.id);

        showNotification(`Группа "${groupName}" успешно импортирована (${newGroup.scripts.length} скриптов)`, 'success');
      } catch (error) {
        showNotification('Ошибка при импорте группы: ' + error.message, 'error');
        console.error(error);
      }
    };
    reader.readAsText(file);
  };

  input.click();
}
        </script>

        <!--Прочий код-->

        <textarea id="descriptionInput" class="form-control" placeholder="Введите описание с форматированием"></textarea>
        <div class="char-counter" id="charCounter">0 символов</div>
        <div class="preview-container" id="descriptionPreview"></div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-header">
        <i class="fas fa-backpack"></i> <i class="fas fa-boxes"></i> Инвентарь
      </div>
      <div class="panel-body">
        <div class="server-selector">
          <label>Выберите сервер:</label>
          <div class="custom-select">
            <div class="select-selected" id="select-selected">
              <img src="assets/flxp-icon.png" class="server-icon">
              <span>Все серверы</span>
            </div>
            <div class="select-items" id="select-items">
              <div class="select-option" data-value="All" data-img="assets/flxp-icon.png">
                <img src="assets/flxp-icon.png" class="server-icon">
                <span>Все серверы</span>
              </div>
              <div class="select-option" data-value="MediumRP" data-img="assets/purple.png">
                <img src="assets/purple.png" class="server-icon">
                <span>MediumRP</span>
              </div>
              <div class="select-option" data-value="Classic" data-img="assets/red.png">
                <img src="assets/red.png" class="server-icon">
                <span>Classic</span>
              </div>
              <div class="select-option" data-value="AutoEvents" data-img="assets/yellow.png">
                <img src="assets/yellow.png" class="server-icon">
                <span>AutoEvents</span>
              </div>
              <div class="select-option" data-value="LightRP" data-img="assets/blue.png">
                <img src="assets/blue.png" class="server-icon">
                <span>LightRP</span>
              </div>
              <div class="select-option" data-value="FullRP" data-img="assets/cyan.png">
                <img src="assets/cyan.png" class="server-icon">
                <span>FullRP</span>
              </div>
              <div class="select-option" data-value="HardRP" data-img="assets/gray.png">
                <img src="assets/gray.png" class="server-icon">
                <span>HardRP</span>
              </div>
              <div class="select-option" data-value="FunRP" data-img="assets/green.png">
                <img src="assets/green.png" class="server-icon">
                <span>FunRP</span>
              </div>
              <div class="select-option" data-value="EventRP" data-img="assets/mint.png">
                <img src="assets/mint.png" class="server-icon">
                <span>EventRP</span>
              </div>
            </div>
            <select id="serverSelect" style="display:none;">
              <option value="All">Все серверы</option>
              <option value="MediumRP">MediumRP</option>
              <option value="Classic">Classic</option>
              <option value="AutoEvents">AutoEvents</option>
              <option value="LightRP">LightRP</option>
              <option value="FullRP">FullRP</option>
              <option value="HardRP">HardRP</option>
              <option value="FunRP">FunRP</option>
              <option value="EventRP">EventRP</option>
            </select>
          </div>
        </div>

        <!-- Добавьте эти стили: -->
        <style>
          .server-selector {
            margin-bottom: 15px;
          }
          
          .custom-select {
            position: relative;
            width: 100%;
          }
          
          .select-selected {
            background-color: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.3s;
          }
          
          .select-selected:hover {
            border-color: var(--primary);
          }
          
          .select-items {
            display: none;
            position: absolute;
            background-color: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 4px;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 99;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
          }
          
          .select-option {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.2s;
          }
          
          .select-option:hover {
            background-color: rgba(74, 111, 165, 0.1);
          }
          
          .select-option img {
            margin-right: 10px;
          }
          
          .server-icon {
            width: 20px;
            height: 20px;
            object-fit: contain;
          }
          /* Для активного состояния */
          
          .select-selected.active + .select-items {
            display: block;
          }
        </style>

        <!-- Добавьте этот JavaScript: -->
        <script>
          document.addEventListener('DOMContentLoaded', function() {
            const selectSelected = document.getElementById('select-selected');
            const selectItems = document.getElementById('select-items');
            const selectOptions = document.querySelectorAll('.select-option');
            const serverSelect = document.getElementById('serverSelect');
            // Обработчик клика по выбранному элементу
            selectSelected.addEventListener('click', function(e) {
              e.stopPropagation();
              selectItems.style.display = selectItems.style.display === 'block' ? 'none' : 'block';
              this.classList.toggle('active');
            });
            // Обработчики для опций
            selectOptions.forEach(option => {
              option.addEventListener('click', function() {
                const value = this.getAttribute('data-value');
                const img = this.getAttribute('data-img');
                const text = this.querySelector('span').textContent;
                // Обновляем выбранный элемент
                selectSelected.innerHTML = `<img src="${img}" class="server-icon"><span>${text}</span>`;
                // Обновляем скрытый select
                serverSelect.value = value;
                // Закрываем выпадающий список
                selectItems.style.display = 'none';
                selectSelected.classList.remove('active');
                // Триггерим событие изменения
                serverSelect.dispatchEvent(new Event('change'));
              });
            });
            // Закрытие при клике вне списка
            document.addEventListener('click', function() {
              selectItems.style.display = 'none';
              selectSelected.classList.remove('active');
            });
            // Инициализация при загрузке
            const initialOption = selectOptions[0];
            const initialValue = initialOption.getAttribute('data-value');
            const initialImg = initialOption.getAttribute('data-img');
            const initialText = initialOption.querySelector('span').textContent;
            selectSelected.innerHTML = `<img src="${initialImg}" class="server-icon"><span>${initialText}</span>`;
            serverSelect.value = initialValue;
          });
        </script>
        <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
        <div class="inventory">
          <div class="inventory-slot" id="slot1" onclick="selectSlot(1)" data-slot="Слот 1">
            <div class="slot-content">Пусто</div>
          </div>
          <div class="inventory-slot" id="slot2" onclick="selectSlot(2)" data-slot="Слот 2">
            <div class="slot-content">Пусто</div>
          </div>
          <div class="inventory-slot" id="slot3" onclick="selectSlot(3)" data-slot="Слот 3">
            <div class="slot-content">Пусто</div>
          </div>
          <div class="inventory-slot" id="slot4" onclick="selectSlot(4)" data-slot="Слот 4">
            <div class="slot-content">Пусто</div>
          </div>
          <div class="inventory-slot" id="slot5" onclick="selectSlot(5)" data-slot="Слот 5">
            <div class="slot-content">Пусто</div>
          </div>
          <div class="inventory-slot" id="slot6" onclick="selectSlot(6)" data-slot="Слот 6">
            <div class="slot-content">Пусто</div>
          </div>
          <div class="inventory-slot" id="slot7" onclick="selectSlot(7)" data-slot="Слот 7">
            <div class="slot-content">Пусто</div>
          </div>
          <div class="inventory-slot" id="slot8" onclick="selectSlot(8)" data-slot="Слот 8">
            <div class="slot-content">Пусто</div>
          </div>
        </div>

        <div class="inventory-categories" id="inventoryCategories">
          <!-- Categories will be generated dynamically -->
        </div>

        <div class="item-search-container">
          <input type="text" id="itemSearch" class="form-control" placeholder="Поиск предметов...">
          <button class="btn btn-outline" onclick="clearItemSearch()">
            <i class="fas fa-times"></i> Очистить
          </button>
        </div>

        <div class="item-list-container">
          <div class="item-list" id="itemList">
            <!-- Items will be generated dynamically -->
          </div>
        </div>
      </div>
    </div>

    <!--Инв+-->

    <!-- Модальное окно выбора роли -->
    <div class="modal" id="roleModal">
      <div class="modal-content">
        <span class="close-modal">&times;</span>

        <!-- Боковые кнопки фильтров -->
        <div class="filter-buttons">
          <div class="filter-btn active" data-category="all">
            <img src="assets/as2/none.png" alt="Все">
          </div>
          <div class="filter-btn" data-category="chaos">
            <img src="assets/as2/PHlogo.png" alt="Хаос">
          </div>
          <div class="filter-btn" data-category="mtf">
            <img src="assets/as2/E11.png" alt="МОГ">
          </div>
          <div class="filter-btn" data-category="staff">
            <img src="assets/as2/Facul.png" alt="Персонал">
          </div>
          <div class="filter-btn" data-category="scp">
            <img src="assets/as2/SCP.png" alt="SCP">
          </div>
        </div>

        <!-- Основной контейнер с ролями -->
        <div class="roles-container">
          <input type="text" class="search-box" placeholder="Поиск ролей...">

          <div class="roles-grid" id="rolesGrid">
            <!-- Роли будут добавляться динамически -->
          </div>
        </div>
      </div>
    </div>
    <script src="items.js"></script>
    <script>
      // Inventory variables
      let currentSlot = 1;
      let inventory = {
        1: {
          name: 'Пусто',
          id: '',
          img: ''
        },
        2: {
          name: 'Пусто',
          id: '',
          img: ''
        },
        3: {
          name: 'Пусто',
          id: '',
          img: ''
        },
        4: {
          name: 'Пусто',
          id: '',
          img: ''
        },
        5: {
          name: 'Пусто',
          id: '',
          img: ''
        },
        6: {
          name: 'Пусто',
          id: '',
          img: ''
        },
        7: {
          name: 'Пусто',
          id: '',
          img: ''
        },
        8: {
          name: 'Пусто',
          id: '',
          img: ''
        }
      };
      let currentCategory = '';
      let currentSubcategory = '';
      // Initialize inventory when DOM is loaded
      document.addEventListener('DOMContentLoaded', function() {
        initServerSelect();
        initInventory();
        // Other initialization code...
      });
      // Inventory functions
      function selectSlot(slot) {
        // Remove active class from all slots
        document.querySelectorAll('.inventory-slot').forEach(s => {
          s.classList.remove('active');
        });
        // Add active class to selected slot
        document.getElementById(`slot${slot}`).classList.add('active');
        currentSlot = slot;
        // Update item list based on current filters
        filterItems();
      }

      function selectItem(item) {
        inventory[currentSlot] = {
          name: item.name,
          id: item.id,
          img: item.img || ''
        };
        const slotElement = document.getElementById(`slot${currentSlot}`);
        const imgHtml = item.img ?
          `<img src="${item.img}" class="slot-img" loading="lazy" onerror="this.style.display='none'">` :
          '';
        slotElement.innerHTML = `
        <div class="slot-content">
            ${imgHtml}
            <div>${item.name}</div>
        </div>
    `;
        generateCLscript();
        updateThumbnailPreview();
      }
      let allCategories = new Set();
      let serverItemsCache = {};
      // Инициализация при загрузке
      document.addEventListener('DOMContentLoaded', function() {
        // Сначала собираем ВСЕ возможные категории
        collectAllCategories();
        // Затем инициализируем интерфейс
        initInventory();
      });
      // Собираем все категории из всех предметов
      function collectAllCategories() {
        allItems.forEach(item => {
          if (item.category) allCategories.add(item.category);
        });
      }

      function updateCategoriesCount() {
        const server = document.getElementById('serverSelect').value;
        // Кэшируем предметы для сервера
        if (!serverItemsCache[server]) {
          serverItemsCache[server] = allItems.filter(item =>
            item.server === 'all' || item.server === server
          );
        }
        const serverItems = serverItemsCache[server];
        // Обновляем кнопки категорий
        document.querySelectorAll('.category-btn:not(.all-btn)').forEach(btn => {
          const category = btn.dataset.category;
          const count = serverItems.filter(item => item.category === category).length;
          btn.innerHTML = `<i class="${getCategoryIcon(category)}"></i> ${category} (${count})`;
          // Делаем кнопку неактивной если нет предметов
          btn.classList.toggle('disabled', count === 0);
        });
      }

      function updateSlotDisplay(slot) {
        const slotElement = document.getElementById(`slot${slot}`);
        const item = inventory[slot];
        if (item.img) {
          slotElement.innerHTML = `
                    <div class="slot-content">
                        <img src="${item.img}" class="slot-img" onerror="this.style.display='none'">
                        <div>${item.name}</div>
                    </div>
                `;
        } else {
          slotElement.innerHTML = `<div class="slot-content">${item.name}</div>`;
        }
        slotElement.setAttribute('data-slot', `Слот ${slot}`);
      }

      function clearSlot(slot) {
        inventory[slot] = {
          name: 'Пусто',
          id: '',
          img: ''
        };
        updateSlotDisplay(slot);
        generateCLscript();
      }

      function initInventory() {
        // Инициализация слотов
        for (let i = 1; i <= 8; i++) {
          updateSlotDisplay(i);
        }
        // Выбираем первый слот по умолчанию
        selectSlot(1);
        // Инициализация категорий
        initCategories();
        // Загрузка предметов
        filterItems();
        // Обработчик изменения сервера
        document.getElementById('serverSelect').addEventListener('change', function() {
          updateCategoriesCount();
          filterItems();
          clearUnavailableItems();
        });
      }

      function initCategories() {
        const categoriesContainer = document.getElementById('inventoryCategories');
        categoriesContainer.innerHTML = '';
        // Создаем группу категорий
        const categoryGroup = document.createElement('div');
        categoryGroup.className = 'category-group';
        // Кнопка "Все"
        const allBtn = document.createElement('button');
        allBtn.className = 'category-btn all-btn active';
        allBtn.innerHTML = '<i class="fas fa-list"></i> Все';
        allBtn.onclick = () => {
          document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
          allBtn.classList.add('active');
          currentCategory = '';
          currentSubcategory = '';
          filterItems();
          document.querySelectorAll('.subcategory-group').forEach(group => group.remove());
        };
        categoryGroup.appendChild(allBtn);
        // Добавляем ВСЕ категории, даже если предметов нет
        allCategories.forEach(category => {
          const btn = document.createElement('button');
          btn.className = 'category-btn';
          btn.dataset.category = category;
          btn.innerHTML = `<i class="fas fa-${getCategoryIcon(category)}"></i> ${category} (0)`;
          btn.onclick = () => {
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            btn.classList.add('active');
            currentCategory = category;
            currentSubcategory = '';
            filterItems();
            showSubcategories(category);
          };
          categoryGroup.appendChild(btn);
        });
        categoriesContainer.appendChild(categoryGroup);
        // Первоначальное обновление счетчиков
        updateCategoriesCount();
      }

      function createCategoryButton(text, icon, category) {
        const btn = document.createElement('button');
        btn.className = 'category-btn';
        btn.innerHTML = `<i class="fas fa-${icon}"></i> ${text}`;
        btn.onclick = () => {
          document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
          btn.classList.add('active');
          currentCategory = category;
          currentSubcategory = '';
          filterItems();
          showSubcategories(category);
        };
        return btn;
      }

      function getCategoryIcon(category) {
        const icons = {
          'Оружие': 'fas fa-gun',
          'Медицина': 'fas fa-medkit',
          'Броня': 'fas fa-shield-alt',
          'Гранаты': 'fas fa-bomb',
          'Ключ-карты': 'fas fa-key',
          'Радио': 'fas fa-comment-alt',
          'Фонари': 'fas fa-lightbulb',
          'SCP-объекты': 'fas fa-biohazard',
          'Инструменты': 'fas fa-tools',
          'Еда': 'fas fa-utensils',
          'Сумки': 'fas fa-bag-shopping',
          'Электроника': 'fas fa-microchip',
          'Документы': 'fas fa-file-alt',
          'Спецсредства': 'fas fa-lock',
          'Бытовые предметы': 'fas fa-box-open'
        };
        return icons[category] || 'bullhorn';
      }

      function showSubcategories(category) {
        const categoriesContainer = document.getElementById('inventoryCategories');
        // Remove existing subcategory groups
        document.querySelectorAll('.subcategory-group').forEach(group => group.remove());
        // Get unique subcategories for current category and server
        const server = document.getElementById('serverSelect').value;
        const subcategories = [...new Set(allItems
          .filter(item => item.category === category && (item.server === 'all' || item.server === server))
          .map(item => item.subcategory)
          .filter(sub => sub)
        )];
        if (subcategories.length === 0) return;
        // Create subcategory group
        const subcategoryGroup = document.createElement('div');
        subcategoryGroup.className = 'subcategory-group';
        // Add "All" subcategory button
        const allSubBtn = document.createElement('button');
        allSubBtn.className = 'subcategory-btn active';
        allSubBtn.textContent = 'Все';
        allSubBtn.onclick = () => {
          document.querySelectorAll('.subcategory-btn').forEach(btn => btn.classList.remove('active'));
          allSubBtn.classList.add('active');
          currentSubcategory = '';
          filterItems();
        };
        subcategoryGroup.appendChild(allSubBtn);
        // Add subcategory buttons
        subcategories.forEach(subcategory => {
          const btn = document.createElement('button');
          btn.className = 'subcategory-btn';
          btn.textContent = subcategory;
          btn.onclick = () => {
            document.querySelectorAll('.subcategory-btn').forEach(btn => btn.classList.remove('active'));
            btn.classList.add('active');
            currentSubcategory = subcategory;
            filterItems();
          };
          subcategoryGroup.appendChild(btn);
        });
        categoriesContainer.appendChild(subcategoryGroup);
      }

      function filterItems() {
        const itemList = document.getElementById('itemList');
        const server = document.getElementById('serverSelect').value;
        const searchQuery = document.getElementById('itemSearch').value.toLowerCase();
        // Используем кэш если есть
        const serverItems = serverItemsCache[server] ||
          allItems.filter(item => item.server === 'all' || item.server === server);
        // Фильтрация
        const filteredItems = serverItems.filter(item => {
          const categoryMatch = !currentCategory || item.category === currentCategory;
          const subcategoryMatch = !currentSubcategory || item.subcategory === currentSubcategory;
          const searchMatch = !searchQuery ||
            item.name.toLowerCase().includes(searchQuery) ||
            (item.id && item.id.toString().toLowerCase().includes(searchQuery));
          return categoryMatch && subcategoryMatch && searchMatch;
        });
        // Очищаем список
        itemList.innerHTML = '';
        // Быстрое добавление через DocumentFragment
        const fragment = document.createDocumentFragment();
        if (filteredItems.length === 0) {
          const noItems = document.createElement('div');
          noItems.className = 'no-items';
          noItems.textContent = 'Нет предметов';
          fragment.appendChild(noItems);
        } else {
          filteredItems.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'item';
                // Используем шаблонные строки
                itemElement.innerHTML = `
                ${item.img ? ` <img src = "${item.img}"
                class = "item-img"
                loading = "lazy"
                onerror = "this.style.display='none'"> ` : ''}
                <div class="item-name">${item.name}</div>
                ${item.id ? ` <div class = "item-id"> ID: ${item.id} </div>` : ''}
                `;
            
            itemElement.onclick = () => selectItem(item);
            fragment.appendChild(itemElement);
        });
    }
    
    itemList.appendChild(fragment);
}

// Добавляем стиль для неактивных кнопок
const style = document.createElement('style');
style.textContent = `
                .category - btn.disabled {
                  opacity: 0.5;
                  pointer - events: none;
                }
                `;
document.head.appendChild(style);

        function clearItemSearch() {
            document.getElementById('itemSearch').value = '';
            filterItems();
        }

        function initServerSelect() {
    const serverSelect = document.getElementById('serverSelect');
    
    // Добавляем иконки к опциям
    Array.from(serverSelect.options).forEach(option => {
        const imgSrc = option.getAttribute('data-img');
        if (imgSrc) {
            option.innerHTML = ` <img src = "${imgSrc}"
                class = "server-icon"> $ {
                  option.textContent
                }
                `;
        }
    });
    
    serverSelect.addEventListener('change', function() {
        // Обновляем отображение выбранного сервера с иконкой
        const selectedOption = this.options[this.selectedIndex];
        const imgSrc = selectedOption.getAttribute('data-img');
        
        if (imgSrc) {
            this.selectedIndex = this.selectedIndex; // Это обновит отображение
        }
        
        filterItems();
        clearUnavailableItems();
    });
    
    // Инициализируем при загрузке
    serverSelect.dispatchEvent(new Event('change'));
}

        // Rest of your existing JavaScript remains the same...
    </script>
    <script>
      // Инициализация слотов инвентаря
      // Данные предметов
      function getItemsForCurrentServer() {
        const serverSelect = document.getElementById('serverSelect').value;
        const searchQuery = document.getElementById('itemSearch').value.toLowerCase();
        return allItems.filter(item => {
          // Проверяем соответствие серверу (или все серверы)
          const serverMatch = serverSelect === 'all' ? item.server === 'all' : item.server === serverSelect || item.server === 'all';
          // Проверяем соответствие поисковому запросу
          const searchMatch = item.name.toLowerCase().includes(searchQuery) ||
            item.id.toString().toLowerCase().includes(searchQuery);
          return serverMatch && searchMatch;
        });
      }
      // Функция для фильтрации предметов
      // Функция для добавления предмета в список
      function addItemToItemList(item) {
        const itemList = document.getElementById('itemList');
        const itemElement = document.createElement('div');
        itemElement.className = 'item';
        itemElement.innerHTML = `
                <div class="item-name">${item.name}</div>
                <div class="item-id">ID: ${item.id || 'Нет'}</div>
            `;
        itemElement.onclick = () => selectItem(item.name, item.id);
        itemList.appendChild(itemElement);
      }
      // Функция для проверки доступности предмета на текущем сервере
      function isItemAvailableForCurrentServer(itemId) {
        const serverSelect = document.getElementById('serverSelect').value;
        const items = allItems.filter(item => item.id === itemId);
        // Если предмет есть для всех серверов или для текущего сервера
        return items.some(item => item.server === 'all' || item.server === serverSelect);
      }
      // Обработчик изменения сервера
      document.getElementById('serverSelect').addEventListener('change', function() {
        filterItems();
        clearUnavailableItems();
      });
      // Функция для очистки предметов, недоступных на текущем сервере
      function clearUnavailableItems() {
        for (let i = 1; i <= 8; i++) {
          if (inventory[i].id && !isItemAvailableForCurrentServer(inventory[i].id)) {
            clearSlot(i);
          }
        }
      }
      // Данные ролей с индивидуальными цветами
      const rolesData = [{
        id: "ChaosConscript",
        name: "Новобранец ПХ",
        image: "assets/as2/asmodel/PH.png",
        icon: "assets/as2/PH.png",
        category: "chaos",
        color: "#559101"
      }, {
        id: "ChaosMarauder",
        name: "Усмиритель ПХ",
        image: "assets/as2/asmodel/PH.png",
        icon: "assets/as2/PH.png",
        category: "chaos",
        color: "#066328"
      }, {
        id: "ChaosRepressor",
        name: "Мародёр ПХ",
        image: "assets/as2/asmodel/PH.png",
        icon: "assets/as2/PH.png",
        category: "chaos",
        color: "#15853D"
      }, {
        id: "ChaosRifleman",
        name: "Стрелок ПХ",
        image: "assets/as2/asmodel/PH.png",
        icon: "assets/as2/PH.png",
        category: "chaos",
        color: "#008F1C"
      }, {
        id: "NtfCaptain",
        name: "Капитан МОГ",
        image: "assets/as2/asmodel/MTF.png",
        icon: "assets/as2/MTF.png",
        category: "mtf",
        color: "#003DCA"
      }, {
        id: "NtfPrivate",
        name: "Рядовой МОГ",
        image: "assets/as2/asmodel/MTF.png",
        icon: "assets/as2/MTF.png",
        category: "mtf",
        color: "#70C3FF"
      }, {
        id: "NtfSergeant",
        name: "Сержант МОГ",
        image: "assets/as2/asmodel/MTF.png",
        icon: "assets/as2/MTF.png",
        category: "mtf",
        color: "#0096FF"
      }, {
        id: "NtfSpecialist",
        name: "Специалист МОГ",
        image: "assets/as2/asmodel/MTF.png",
        icon: "assets/as2/MTF.png",
        category: "mtf",
        color: "#00D9FF"
      }, {
        id: "FacilityGuard",
        name: "Охранник",
        image: "assets/as2/asmodel/Guard.png",
        icon: "assets/as2/Guard.png",
        category: "staff",
        color: "#5B6370"
      }, {
        id: "Scientist",
        name: "Учёный",
        image: "assets/as2/asmodel/Sines.png",
        icon: "assets/as2/Sines.png",
        category: "staff",
        color: "#FFFF7C"
      }, {
        id: "ClassD",
        name: "Класс Д",
        image: "assets/as2/asmodel/ClassD.png",
        icon: "assets/as2/ClassD.png",
        category: "staff",
        color: "#FF8E00"
      }, {
        id: "Scp049",
        name: "SCP-049",
        image: "assets/as2/asmodel/049.png",
        icon: "assets/as2/049.png",
        category: "scp",
        color: "#EC2222"
      }, {
        id: "Scp0492",
        name: "SCP-049-2",
        image: "assets/as2/asmodel/049-2.png",
        icon: "assets/as2/049-2.png",
        category: "scp",
        color: "#EC2222"
      }, {
        id: "Scp079",
        name: "SCP-079",
        image: "assets/as2/asmodel/079.png",
        icon: "assets/as2/079.png",
        category: "scp",
        color: "#EC2222"
      }, {
        id: "Scp096",
        name: "SCP-096",
        image: "assets/as2/asmodel/096.png",
        icon: "assets/as2/096.png",
        category: "scp",
        color: "#EC2222"
      }, {
        id: "Scp106",
        name: "SCP-106",
        image: "assets/as2/asmodel/106.png",
        icon: "assets/as2/106.png",
        category: "scp",
        color: "#EC2222"
      }, {
        id: "Scp173",
        name: "SCP-173",
        image: "assets/as2/asmodel/173.png",
        icon: "assets/as2/173.png",
        category: "scp",
        color: "#EC2222"
      }, {
        id: "Scp3114",
        name: "SCP-3114",
        image: "assets/as2/asmodel/3114.png",
        icon: "assets/as2/3114.png",
        category: "scp",
        color: "#EC2222"
      }, {
        id: "Scp939",
        name: "SCP-939",
        image: "assets/as2/asmodel/939.png",
        icon: "assets/as2/939.png",
        category: "scp",
        color: "#EC2222"
      }, {
        id: "Tutorial",
        name: "Обучение",
        image: "assets/as2/asmodel/Tutor.png",
        icon: "assets/as2/Tutor.png",
        category: "other",
        color: "#F700FD"
      }];
      // Инициализация при загрузке
      document.addEventListener('DOMContentLoaded', function() {
        const themeToggle = document.getElementById('themeToggle');
        // Проверяем сохраненную тему
        if (localStorage.getItem('darkTheme') === 'enabled') {
          document.body.classList.add('dark-theme');
          themeToggle.checked = true;
        }
        // Обработчик изменения темы
        themeToggle.addEventListener('change', function() {
          if (this.checked) {
            document.body.classList.add('dark-theme');
            localStorage.setItem('darkTheme', 'enabled');
          } else {
            document.body.classList.remove('dark-theme');
            localStorage.setItem('darkTheme', 'disabled');
          }
        });
        // Инициализация слайдеров и их числовых полей
        initSlider('hpSlider', 'hpValue', 'hpInput');
        initSlider('ammo556Slider', 'ammo556Value', 'ammo556Input');
        initSlider('ammo762Slider', 'ammo762Value', 'ammo762Input');
        initSlider('ammo9Slider', 'ammo9Value', 'ammo9Input');
        initSlider('ammo12Slider', 'ammo12Value', 'ammo12Input');
        initSlider('ammo44Slider', 'ammo44Value', 'ammo44Input');
        // Обновление предпросмотра описания
        document.getElementById('descriptionInput').addEventListener('input', updatePreview);
        // Выделяем первый слот инвентаря
        selectSlot(1);
        // Инициализация списка предметов
        filterItems();
        // Инициализация модального окна ролей
        initRoleModal();
        // Добавляем анимацию для уведомлений
        const style = document.createElement('style');
        style.innerHTML = `
                @keyframes fadeIn {
                    from {opacity: 0; transform: translateY(20px);}
                    to {opacity: 1; transform: translateY(0);}
                }
                @keyframes fadeOut {
                    from {opacity: 1; transform: translateY(0);}
                    to {opacity: 0; transform: translateY(20px);}
                }
            `;
        document.head.appendChild(style);
        // Автоматическая генерация скрипта при изменениях
        setupAutoGeneration();
        // Автоматическая фильтрация предметов при изменении сервера
        document.getElementById('serverSelect').addEventListener('change', filterItems);
        // Автоматическая фильтрация предметов при поиске
        document.getElementById('itemSearch').addEventListener('input', filterItems);
      });
      // Настройка автоматической генерации скрипта
      function setupAutoGeneration() {
        // Основные параметры
        document.getElementById('playerID').addEventListener('input', generateCLscript);
        document.getElementById('nickname').addEventListener('input', generateCLscript);
        document.getElementById('hpSlider').addEventListener('input', generateCLscript);
        document.getElementById('hpInput').addEventListener('input', generateCLscript);
        // Инфополя
        const infoCheckboxes = document.querySelectorAll('.checkbox-item input');
        infoCheckboxes.forEach(checkbox => {
          checkbox.addEventListener('change', generateCLscript);
        });
        // Роль
        document.getElementById('roleSelect').addEventListener('change', generateCLscript);
        // Патроны
        document.getElementById('ammo556Slider').addEventListener('input', generateCLscript);
        document.getElementById('ammo556Input').addEventListener('input', generateCLscript);
        document.getElementById('ammo762Slider').addEventListener('input', generateCLscript);
        document.getElementById('ammo762Input').addEventListener('input', generateCLscript);
        document.getElementById('ammo9Slider').addEventListener('input', generateCLscript);
        document.getElementById('ammo9Input').addEventListener('input', generateCLscript);
        document.getElementById('ammo12Slider').addEventListener('input', generateCLscript);
        document.getElementById('ammo12Input').addEventListener('input', generateCLscript);
        document.getElementById('ammo44Slider').addEventListener('input', generateCLscript);
        document.getElementById('ammo44Input').addEventListener('input', generateCLscript);
        // Описание
        document.getElementById('descriptionInput').addEventListener('input', generateCLscript);
        // Инвентарь (обрабатывается в selectItem)
      }
      // Инициализация слайдера с привязкой к числовому полю
      function initSlider(sliderId, valueId, inputId) {
        const slider = document.getElementById(sliderId);
        const value = document.getElementById(valueId);
        const input = document.getElementById(inputId);
        slider.addEventListener('input', function() {
          value.textContent = this.value;
          input.value = this.value;
          generateCLscript();
        });
        input.addEventListener('input', function() {
          const val = Math.min(Math.max(this.value, slider.min), slider.max);
          slider.value = val;
          value.textContent = val;
          this.value = val;
          generateCLscript();
        });
      }
      // Функция для выбора слота инвентаря
      // Функция для выбора предмета
      // Функция для очистки слота
      // Функция для вставки тегов форматирования
      function insertTag(tag) {
        const textarea = document.getElementById('descriptionInput');
        const startPos = textarea.selectionStart;
        const endPos = textarea.selectionEnd;
        const selectedText = textarea.value.substring(startPos, endPos);
        const beforeText = textarea.value.substring(0, startPos);
        const afterText = textarea.value.substring(endPos);
        if (tag === '\\n') {
          textarea.value = beforeText + '\\n' + afterText;
        } else if (tag === 'size') {
          const size = document.getElementById('sizeInput').value;
          textarea.value = beforeText + `<size=${size}>${selectedText}</size>` + afterText;
        } else if (tag.startsWith('color=')) {
          // Обработка цвета с закрытием предыдущего цвета
          const color = tag.split('=')[1];
          let newBeforeText = beforeText;
          // Проверяем, есть ли незакрытый цвет перед курсором
          const lastColorOpen = newBeforeText.lastIndexOf('<color=');
          const lastColorClose = newBeforeText.lastIndexOf('</color>');
          if (lastColorOpen > lastColorClose) {
            // Находим цвет предыдущего тега
            const prevColorStart = newBeforeText.indexOf('=', lastColorOpen) + 1;
            const prevColorEnd = newBeforeText.indexOf('>', prevColorStart);
            const prevColor = newBeforeText.substring(prevColorStart, prevColorEnd);
            // Закрываем предыдущий цвет
            newBeforeText = newBeforeText + '</color>';
            // Открываем новый цвет
            textarea.value = newBeforeText + `<color=${color}>${selectedText}</color>` + `<color=${prevColor}>` + afterText;
          } else {
            // Просто вставляем новый цвет
            textarea.value = newBeforeText + `<color=${color}>${selectedText}</color>` + afterText;
          }
        } else {
          textarea.value = beforeText + `<${tag}>${selectedText}</${tag}>` + afterText;
        }
        updatePreview();
        updateCharCounter();
        generateCLscript();
      }

      function getRoleColor(roleId) {
        const role = rolesData.find(r => r.id === roleId);
        return role ? role.color : '#FFFFFF'; // Белый цвет по умолчанию, если роль не найдена
      }
      // Функция для вставки цвета
      function insertColor(color) {
        const textarea = document.getElementById('descriptionInput');
        const startPos = textarea.selectionStart;
        const endPos = textarea.selectionEnd;
        const selectedText = textarea.value.substring(startPos, endPos);
        const beforeText = textarea.value.substring(0, startPos);
        const afterText = textarea.value.substring(endPos);
        let newBeforeText = beforeText;
        let newAfterText = afterText;
        // Проверяем, есть ли незакрытый цвет перед курсором
        const lastColorOpen = newBeforeText.lastIndexOf('<color=');
        const lastColorClose = newBeforeText.lastIndexOf('</color>');
        if (lastColorOpen > lastColorClose) {
          // Находим цвет предыдущего тега
          const prevColorStart = newBeforeText.indexOf('=', lastColorOpen) + 1;
          const prevColorEnd = newBeforeText.indexOf('>', prevColorStart);
          const prevColor = newBeforeText.substring(prevColorStart, prevColorEnd);
          // Закрываем предыдущий цвет
          newBeforeText = newBeforeText + '</color>';
          // Открываем новый цвет и сохраняем предыдущий для afterText
          newAfterText = `<color=${prevColor}>` + afterText;
        }
        textarea.value = newBeforeText + `<color=${color}>${selectedText}</color>` + newAfterText;
        updatePreview();
        updateCharCounter();
        generateCLscript();
      }

      function updateCharCounter() {
        const text = document.getElementById('descriptionInput').value;
        const charCounter = document.getElementById('charCounter');
        charCounter.textContent = `${text.length} символов`;
        // Добавляем предупреждение если превышен лимит (например, 500 символов)
        if (text.length > 500) {
          charCounter.style.color = 'var(--danger)';
        } else {
          charCounter.style.color = 'var(--gray)';
        }
      }
      // Обновление предпросмотра описания
      function updatePreview() {
        let text = document.getElementById('descriptionInput').value;
        const roleId = document.getElementById('roleSelect').value;
        const roleColor = getRoleColor(roleId);
        // Заменяем \n на <br>
        text = text.replace(/\\n/g, '<br>');
        // Заменяем теги форматирования
        text = text.replace(/<b>(.*?)<\/b>/g, '<b>$1</b>');
        text = text.replace(/<i>(.*?)<\/i>/g, '<i>$1</i>');
        text = text.replace(/<size=(.*?)>(.*?)<\/size>/g, '<span style="font-size:$1px">$2</span>');
        text = text.replace(/<color=(.*?)>(.*?)<\/color>/g, '<span style="color:$1">$2</span>');
        // Устанавливаем базовый цвет из роли
        const previewContainer = document.getElementById('descriptionPreview');
        previewContainer.innerHTML = text;
        previewContainer.style.color = roleColor;
        updateCharCounter();
      }
      // Функция для расчета суммы инфополей
      function calculateInfoSum() {
        let sum = 0;
        if (document.getElementById('nicknameCheckbox').checked) sum += Math.pow(2, 0);
        if (document.getElementById('badgeCheckbox').checked) sum += Math.pow(2, 1);
        if (document.getElementById('customInfoCheckbox').checked) sum += Math.pow(2, 2);
        if (document.getElementById('roleCheckbox').checked) sum += Math.pow(2, 3);
        if (document.getElementById('unitNameCheckbox').checked) sum += Math.pow(2, 4);
        if (document.getElementById('powerStatusCheckbox').checked) sum += Math.pow(2, 5);
        return sum;
      }
      // Функция для генерации CLscript
      function generateCLscript() {
        const playerID = document.getElementById('playerID').value;
        const description = document.getElementById('descriptionInput').value;
        const nickname = document.getElementById('nickname').value;
        const hp = document.getElementById('hpSlider').value;
        const roleId = document.getElementById('roleSelect').value;
        const role = rolesData.find(r => r.id === roleId);
        // Получаем HTML из предпросмотра описания
        const customInfoHTML = document.getElementById('descriptionPreview').innerHTML;
        // Создаем информационные строки
        let infoLines = [];
        // Плашка (если галочка установлена)
        if (document.getElementById('badgeCheckbox').checked) {
          infoLines.push(`<span style="color:#98FB98">СтаффРоль/Плашка</span>`);
        }
        // Кастом-инфо (если галочка установлена) - берем из предпросмотра
        if (document.getElementById('customInfoCheckbox').checked && customInfoHTML.trim() !== '') {
          infoLines.push(customInfoHTML);
        }
        // Никнэйм (если галочка установлена)
        if (document.getElementById('nicknameCheckbox').checked) {
          infoLines.push(`Никнэйм - <span style="color:${role ? role.color : '#FFFFFF'}">${nickname}</span>`);
        }
        // Роль (если галочка установлена)
        if (document.getElementById('roleCheckbox').checked && role) {
          infoLines.push(`Роль - <span style="color:${role.color}">${role.name}</span>`);
        }
        // Номер отряда (если галочка установлена)
        if (document.getElementById('unitNameCheckbox').checked) {
          infoLines.push(`Номер отряда - <span style="color:${role ? role.color : '#FFFFFF'}">1</span>`);
        }
        // Ранг (если галочка установлена)
        if (document.getElementById('powerStatusCheckbox').checked) {
          infoLines.push(`Ранг - <span style="color:${role ? role.color : '#FFFFFF'}">Игрок выше/ниже тебя по званию</span>`);
        }
        // Объединяем строки через <br>
        const infoHTML = infoLines.join('<br>');
        // Получаем элемент для отображения информации
        const descriptionElement = document.getElementById('thumbnailDescription');
        // Устанавливаем HTML или сообщение, если ничего не выбрано
        descriptionElement.innerHTML = infoLines.length > 0 ? infoHTML : 'Информация не указана';
        const infoString = infoLines.join('\\n');
        let items = [];
        for (let i = 1; i <= 8; i++) {
          if (inventory[i].id) {
            items.push(inventory[i].id);
          } else {
            items.push('');
          }
        }
        // Удаляем пустые слоты в конце
        while (items.length > 0 && items[items.length - 1] === '') {
          items.pop();
        }
        const inventoryString = items.join(',');
        // Формируем строку патронов
        const ammo556 = document.getElementById('ammo556Slider').value;
        const ammo762 = document.getElementById('ammo762Slider').value;
        const ammo9 = document.getElementById('ammo9Slider').value;
        const ammo12 = document.getElementById('ammo12Slider').value;
        const ammo44 = document.getElementById('ammo44Slider').value;
        const ammoString = `Nato9:${ammo9},Nato556:${ammo556},Nato762:${ammo762},Ammo12Gauge:${ammo12},Ammo44Cal:${ammo44}`;
        // Рассчитываем сумму инфополей
        const infoSum = calculateInfoSum();
        // Формируем итоговую строку с правильным порядком параметров
        const clscript = `clscript ${playerID} ${roleId || 'None'};${description};${nickname};${hp};${inventoryString};${ammoString};${infoSum}`;
        document.getElementById('exportOutput').value = clscript;
        // Обновляем миниатюру
        updateThumbnailPreview(infoString);
      }
      // Функция для копирования в буфер обмена
      function copyToClipboard() {
        const exportOutput = document.getElementById('exportOutput');
        exportOutput.select();
        document.execCommand('copy');
        // Показываем уведомление
        const notification = document.createElement('div');
        notification.style.position = 'fixed';
        notification.style.bottom = '20px';
        notification.style.right = '20px';
        notification.style.backgroundColor = 'var(--success)';
        notification.style.color = 'white';
        notification.style.padding = '10px 20px';
        notification.style.borderRadius = '4px';
        notification.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
        notification.style.zIndex = '1000';
        notification.style.animation = 'fadeIn 0.3s, fadeOut 0.3s 2s forwards';
        notification.innerHTML = '<i class="fas fa-check-circle"></i> CLscript скопирован в буфер обмена!';
        document.body.appendChild(notification);
        setTimeout(() => {
          notification.remove();
        }, 2500);
      }
      // Функция для фильтрации предметов
      // Обработчик изменения сервера
      document.getElementById('serverSelect').addEventListener('change', function() {
        filterItems();
        // Очищаем инвентарь при смене сервера (опционально)
        for (let i = 1; i <= 8; i++) {
          if (inventory[i].id && !isItemAvailableForCurrentServer(inventory[i].id)) {
            clearSlot(i);
          }
        }
      });
      // Проверка доступности предмета для текущего сервера
      function isItemAvailableForCurrentServer(itemId) {
        const serverSelect = document.getElementById('serverSelect').value;
        const item = allItems.find(i => i.id === itemId);
        if (!item) return false;
        return item.server === 'all' || item.server === serverSelect;
      }
      // Функция для очистки поиска
      // Функция для импорта CLscript
      function importCLscript() {
        const importInput = document.getElementById('importInput').value.trim();
        const errorElement = document.getElementById('importError');
        errorElement.textContent = '';
        if (!importInput.startsWith('clscript ')) {
          showNotification('Ошибка: скрипт должен начинаться с "clscript "');
          return;
        }
        const scriptBody = importInput.substring(9);
        const parts = scriptBody.split(';');
        if (parts.length < 7) {
          errorElement.textContent = 'Ошибка: неверный формат скрипта (недостаточно частей)';
          return;
        }
        try {
          // Получаем текущий выбранный сервер
          const currentServer = document.getElementById('serverSelect').value;
          // Первая часть содержит ID и роль
          const firstPart = parts[0].split(' ');
          if (firstPart.length < 2) {
            errorElement.textContent = 'Ошибка: первая часть должна содержать ID и роль';
            return;
          }
          // Заполняем основные поля
          document.getElementById('playerID').value = firstPart[0] || '';
          // Устанавливаем роль
          const roleId = firstPart[1];
          document.getElementById('roleSelect').value = roleId;
          updateRolePreview(roleId);
          updatePreview();
          // Описание
          document.getElementById('descriptionInput').value = parts[1] || '';
          // Никнейм
          document.getElementById('nickname').value = parts[2] || '';
          // HP
          const hp = parseInt(parts[3]) || 100;
          document.getElementById('hpSlider').value = hp;
          document.getElementById('hpValue').textContent = hp;
          document.getElementById('hpInput').value = hp;
          // Инвентарь
          const inventoryItems = parts[4].split(',');
          // Сначала очищаем все слоты
          for (let i = 1; i <= 8; i++) {
            inventory[i] = {
              name: 'Пусто',
              id: ''
            };
            document.getElementById('slot' + i).textContent = 'Пусто';
          }
          // Заполняем слоты предметами из скрипта
          for (let i = 0; i < Math.min(inventoryItems.length, 8); i++) {
            const itemId = inventoryItems[i] || '';
            let itemName = 'Пусто';
            if (itemId) {
              // Сначала ищем предмет для текущего сервера
              let foundItem = allItems.find(item =>
                item.id === itemId && (item.server === currentServer || item.server === 'all')
              );
              // Если не найден для текущего сервера, ищем на других серверах
              if (!foundItem && currentServer !== 'all') {
                foundItem = allItems.find(item => item.id === itemId);
              }
              if (foundItem) {
                // Если предмет найден для текущего сервера или это общий предмет
                if (foundItem.server === currentServer || foundItem.server === 'all') {
                  itemName = foundItem.name;
                }
                // Если предмет с другого сервера
                else {
                  itemName = `[${foundItem.server}] ${foundItem.name}`;
                }
              } else {
                // Если предмет не найден вообще
                itemName = `Неизвестный предмет (ID: ${itemId})`;
              }
            }
            inventory[i + 1] = {
              name: itemName,
              id: itemId
            };
            document.getElementById('slot' + (i + 1)).textContent = itemName;
          }
          // Остальной код импорта (патроны, инфополя и т.д.)
          const ammoParts = parts[5].split(',');
          // Сбрасываем все патроны к 0
          document.getElementById('ammo556Slider').value = 0;
          document.getElementById('ammo556Value').textContent = 0;
          document.getElementById('ammo556Input').value = 0;
          document.getElementById('ammo762Slider').value = 0;
          document.getElementById('ammo762Value').textContent = 0;
          document.getElementById('ammo762Input').value = 0;
          document.getElementById('ammo9Slider').value = 0;
          document.getElementById('ammo9Value').textContent = 0;
          document.getElementById('ammo9Input').value = 0;
          document.getElementById('ammo12Slider').value = 0;
          document.getElementById('ammo12Value').textContent = 0;
          document.getElementById('ammo12Input').value = 0;
          document.getElementById('ammo44Slider').value = 0;
          document.getElementById('ammo44Value').textContent = 0;
          document.getElementById('ammo44Input').value = 0;
          // Устанавливаем значения патронов из скрипта
          ammoParts.forEach(part => {
            const [type, value] = part.split(':');
            const amount = parseInt(value) || 0;
            switch (type) {
              case 'Nato556':
                document.getElementById('ammo556Slider').value = amount;
                document.getElementById('ammo556Value').textContent = amount;
                document.getElementById('ammo556Input').value = amount;
                break;
              case 'Nato762':
                document.getElementById('ammo762Slider').value = amount;
                document.getElementById('ammo762Value').textContent = amount;
                document.getElementById('ammo762Input').value = amount;
                break;
              case 'Nato9':
                document.getElementById('ammo9Slider').value = amount;
                document.getElementById('ammo9Value').textContent = amount;
                document.getElementById('ammo9Input').value = amount;
                break;
              case 'Ammo12Gauge':
                document.getElementById('ammo12Slider').value = amount;
                document.getElementById('ammo12Value').textContent = amount;
                document.getElementById('ammo12Input').value = amount;
                break;
              case 'Ammo44Cal':
                document.getElementById('ammo44Slider').value = amount;
                document.getElementById('ammo44Value').textContent = amount;
                document.getElementById('ammo44Input').value = amount;
                break;
            }
          });
          // Инфополя
          const infoSum = parseInt(parts[6]) || 0;
          document.getElementById('nicknameCheckbox').checked = !!(infoSum & Math.pow(2, 0));
          document.getElementById('badgeCheckbox').checked = !!(infoSum & Math.pow(2, 1));
          document.getElementById('customInfoCheckbox').checked = !!(infoSum & Math.pow(2, 2));
          document.getElementById('roleCheckbox').checked = !!(infoSum & Math.pow(2, 3));
          document.getElementById('unitNameCheckbox').checked = !!(infoSum & Math.pow(2, 4));
          document.getElementById('powerStatusCheckbox').checked = !!(infoSum & Math.pow(2, 5));
          // Обновляем предпросмотр
          updatePreview();
          updateCharCounter();
          generateCLscript();
          // Показываем уведомление об успешном импорте
          showNotification('CLscript успешно импортирован!', 'success');
        } catch (e) {
          errorElement.textContent = 'Ошибка при разборе скрипта: ' + e.message;
        }
      }
      // Функция для обновления превью роли
      function updateRolePreview(roleId) {
        const role = rolesData.find(r => r.id === roleId);
        const rolePreviewCard = document.getElementById('rolePreviewCard');
        const rolePreviewContent = document.getElementById('rolePreviewContent');
        if (role) {
          rolePreviewCard.style.background = `linear-gradient(135deg, ${role.color}30, ${role.color}10)`;
          rolePreviewCard.style.borderColor = role.color;
          rolePreviewContent.innerHTML = `
            <img src="${role.image}" class="role-preview-image">
            <div class="role-preview-name">${role.name}</div>
        `;
        } else {
          // Сброс превью, если роль не найдена
          rolePreviewCard.style.background = 'linear-gradient(135deg, #2a2a3c, #1e1e2d)';
          rolePreviewCard.style.borderColor = 'rgba(255,255,255,0.1)';
          rolePreviewContent.innerHTML = `
            <div class="role-preview-icon">
                <i class="fas fa-user-plus"></i>
            </div>
            <div class="role-preview-placeholder">Выберите роль</div>
        `;
        }
        updateThumbnailPreview();
      }
      // Функция для показа уведомлений
      function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.style.position = 'fixed';
        notification.style.bottom = '20px';
        notification.style.right = '20px';
        notification.style.backgroundColor = type === 'success' ? 'var(--success)' : 'var(--danger)';
        notification.style.color = 'white';
        notification.style.padding = '10px 20px';
        notification.style.borderRadius = '4px';
        notification.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
        notification.style.zIndex = '1000';
        notification.style.animation = 'fadeIn 0.3s, fadeOut 0.3s 2s forwards';
        notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : 'exclamation'}-circle"></i> ${message}`;
        document.body.appendChild(notification);
        setTimeout(() => {
          notification.remove();
        }, 2500);
      }
      // Инициализация модального окна ролей
      function initRoleModal() {
        const modal = document.getElementById('roleModal');
        const closeBtn = document.querySelector('.close-modal');
        const rolesGrid = document.getElementById('rolesGrid');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const searchBox = document.querySelector('.search-box');
        const rolePreviewCard = document.getElementById('rolePreviewCard');
        let selectedRole = null;
        let currentCategory = 'all';
        let searchQuery = '';
        // Открытие модального окна
        rolePreviewCard.addEventListener('click', function() {
          modal.style.display = 'flex';
          renderRoles();
        });
        // Закрытие модального окна
        closeBtn.addEventListener('click', function() {
          modal.style.display = 'none';
        });
        // Клик вне модального окна
        window.addEventListener('click', function(event) {
          if (event.target === modal) {
            modal.style.display = 'none';
          }
        });
        // Фильтрация по категориям
        filterButtons.forEach(button => {
          button.addEventListener('click', function() {
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            currentCategory = this.dataset.category;
            renderRoles();
          });
        });
        // Поиск
        searchBox.addEventListener('input', function() {
          searchQuery = this.value.toLowerCase();
          renderRoles();
        });
        // Рендер ролей
        function renderRoles() {
          rolesGrid.innerHTML = '';
          const filteredRoles = rolesData.filter(role => {
            const matchesCategory = currentCategory === 'all' || role.category === currentCategory;
            const matchesSearch = role.name.toLowerCase().includes(searchQuery) ||
              role.id.toLowerCase().includes(searchQuery);
            return matchesCategory && matchesSearch;
          });
          filteredRoles.forEach(role => {
            const roleElement = document.createElement('div');
            roleElement.className = 'role-option';
            roleElement.dataset.value = role.id;
            roleElement.style.color = role.color;
            roleElement.style.backgroundColor = `${role.color}20`;
            roleElement.innerHTML = `
                        <img src="${role.icon}" class="role-image">
                        <div class="role-name">${role.name}</div>
                    `;
            roleElement.addEventListener('click', function() {
              if (selectedRole) {
                selectedRole.classList.remove('selected');
              }
              this.classList.add('selected');
              selectedRole = this;
              // Сохраняем выбранную роль
              document.getElementById('roleSelect').value = role.id;
              // Обновляем карточку предпросмотра роли
              const rolePreviewCard = document.getElementById('rolePreviewCard');
              const rolePreviewContent = document.getElementById('rolePreviewContent');
              rolePreviewCard.style.background = `linear-gradient(135deg, ${role.color}30, ${role.color}10)`;
              rolePreviewCard.style.borderColor = role.color;
              rolePreviewContent.innerHTML = `
                            <img src="${role.image}" class="role-preview-image">
                            <div class="role-preview-name">${role.name}</div>
                        `;
              // Закрываем модальное окно
              modal.style.display = 'none';
              // Генерируем скрипт
              generateCLscript();
            });
            rolesGrid.appendChild(roleElement);
          });
        }
      }
      // Функция для замены переносов строк на <br>
      function replaceNewlinesWithBr(text) {
        return text.replace(/\n/g, '<br>');
      }
      // Пример использования:
      // При обработке текста из textarea (например, перед выводом в preview или экспортом)
      document.getElementById('descriptionInput').addEventListener('input', function() {
        const text = this.value;
        const formattedText = replaceNewlinesWithBr(text);
        document.getElementById('descriptionPreview').innerHTML = formattedText;
      });
      // Если нужно обрабатывать текст при экспорте:
      function generateExportText() {
        const description = document.getElementById('descriptionInput').value;
        const formattedDescription = replaceNewlinesWithBr(description);
        // Далее используйте formattedDescription в вашем экспорте
        document.getElementById('exportOutput').value = formattedDescription;
      }

      function updateThumbnailPreview(infoString = '') {
        const roleId = document.getElementById('roleSelect').value;
        const role = rolesData.find(r => r.id === roleId);
        const thumbnail = document.getElementById('thumbnailPreview');
        const roleImage = document.getElementById('thumbnailRoleImage');
        const descriptionElement = document.getElementById('thumbnailDescription');
        // Устанавливаем изображение роли
        if (role) {
          roleImage.src = role.image;
          thumbnail.style.borderColor = role.color;
        } else {
          roleImage.src = 'assets/as2/asmodel/Tutor.png';
          thumbnail.style.borderColor = getComputedStyle(document.documentElement)
            .getPropertyValue('--input-border').trim();
        }
        // Обработка строки информации
        let formattedInfo = infoString;
        if (formattedInfo) {
          // Заменяем \n на <br> и обрабатываем цветовые теги
          formattedInfo = formattedInfo.replace(/\\n/g, '<br>')
            .replace(/<color=(.*?)>(.*?)<\/color>/g, '<span style="color:$1">$2</span>');
        } else {
          formattedInfo = 'Информация не указана';
        }
        descriptionElement.innerHTML = formattedInfo;
        // Обновляем сетку предметов
        const itemsGrid = document.getElementById('thumbnailItemsGrid');
        itemsGrid.innerHTML = '';
        for (let i = 1; i <= 8; i++) {
          const item = inventory[i];
          const itemElement = document.createElement('div');
          itemElement.className = 'thumbnail-item';
          if (item.id) {
            const itemData = allItems.find(it => it.id === item.id);
            const itemName = item.name.length > 10 ? item.name.substring(0, 8) + '...' : item.name;
            itemElement.innerHTML = `
                ${itemData?.img ? ` <img src = "${itemData.img}"
            class = "thumbnail-item-img"
            onerror = "this.style.display='none'"> ` : '<div class="thumbnail-item-img"></div>'}
                <div class="thumbnail-item-name">${itemName}</div>
                <div class="thumbnail-item-id">ID: ${item.id}</div>
            `;
          } else {
            itemElement.innerHTML = `
                <div class="thumbnail-item-img"></div>
                <div class="thumbnail-item-name">Пусто</div>
                <div class="thumbnail-item-id">-</div>
            `;
          }
          itemsGrid.appendChild(itemElement);
        }
      }

      function copyThumbnailToClipboard() {
        const thumbnail = document.getElementById('thumbnailPreview');
        html2canvas(thumbnail, {
          backgroundColor: null,
          scale: 2,
          logging: true,
          useCORS: true,
          allowTaint: true
        }).then(canvas => {
          canvas.toBlob(function(blob) {
            const item = new ClipboardItem({
              "image/png": blob
            });
            navigator.clipboard.write([item]).then(function() {
              showNotification('Миниатюра скопирована в буфер обмена!', 'success');
            }, function(error) {
              console.error('Ошибка копирования:', error);
              showNotification('Не удалось скопировать миниатюру', 'error');
            });
          });
        }).catch(error => {
          console.error('Error copying thumbnail:', error);
          showNotification('Ошибка при копировании миниатюры', 'error');
        });
      }
      // Функция сохранения миниатюры как изображение
      function saveThumbnail() {
        const thumbnail = document.getElementById('thumbnailPreview');
        // Временно применяем инлайновые стили для корректного рендеринга
        const descriptionElement = document.getElementById('thumbnailDescription');
        const originalStyles = {
          fontFamily: descriptionElement.style.fontFamily,
          color: descriptionElement.style.color,
          textShadow: descriptionElement.style.textShadow
        };
        // Принудительно устанавливаем стили
        descriptionElement.style.fontFamily = 'Roboto, sans-serif';
        descriptionElement.style.color = 'white';
        descriptionElement.style.textShadow = '1px 1px 2px rgba(0,0,0,0.5)';
        html2canvas(thumbnail, {
          backgroundColor: null,
          scale: 2,
          logging: true,
          useCORS: true,
          allowTaint: true,
          letterRendering: true,
          fontFamily: 'Roboto',
          onclone: function(clonedDoc) {
            // Дополнительные настройки для клонированного документа
            const clonedDescription = clonedDoc.getElementById('thumbnailDescription');
            clonedDescription.style.fontFamily = 'Roboto, sans-serif';
            clonedDescription.style.color = 'white';
          }
        }).then(canvas => {
          // Восстанавливаем оригинальные стили
          Object.assign(descriptionElement.style, originalStyles);
          const link = document.createElement('a');
          link.download = 'character-preview.png';
          link.href = canvas.toDataURL('image/png');
          link.click();
          showNotification('Миниатюра успешно сохранена!', 'success');
        }).catch(error => {
          console.error('Error saving thumbnail:', error);
          // Восстанавливаем стили даже при ошибке
          Object.assign(descriptionElement.style, originalStyles);
          showNotification('Ошибка при сохранении миниатюры', 'error');
        });
      }
    </script>

    <!-- предупреждение -->

    <div class="disclaimer-panel" style="margin: 30px auto; max-width: 800px; background: var(--panel-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
      <div style="text-align: center;">
        <p style="color: var(--text-color); margin-bottom: 10px; font-size: 1.1em;">Данное приложение <strong style="color: var(--accent-color);">не является</strong> официальным продуктом FLX-project</p>
        <p style="color: var(--gray); margin-bottom: 15px;">
          Оно было создано сторонним разработчиком
          <a href="#" id="dev-profile-link" style="color: var(--primary); text-decoration: none; font-weight: 500; transition: all 0.2s; display: inline-flex; align-items: center;">
                @pogusik
                <img src="./assets/discord-icon.png" alt="Discord" style="width: 16px; height: 16px; margin-left: 5px;">
            </a> для ивентологов FLX-project.
        </p>
        <div style="background: rgba(114, 137, 218, 0.1); border-radius: 6px; padding: 10px; margin-top: 15px;">
          <p style="color: var(--gray); font-size: 0.9em; margin: 0;">
            <i class="fas fa-bug" style="margin-right: 5px;"></i> По всем вопросам, баг-репортам и предложениям пишите в личные сообщения
          </p>
        </div>
      </div>
    </div>

    <!-- Мини-профиль пользователя -->
    <div class="mini-profile-modal" id="user-profile-modal">
      <div class="mini-profile-content">
        <span class="close-mini-profile">&times;</span>
        <div class="loading">
          <div class="spinner"></div>
          <p>Загрузка профиля...</p>
        </div>
        <div class="profile-content" style="display: none;">
          <div class="profile-banner" style="background-color: #ffffff;"></div>
          <div class="profile-avatar-container">
            <img src="https://cdn.discordapp.com/avatars/778668132541530132/72bff8cc9bcecca82c4b9f552ce60bed.webp?size=256" class="profile-avatar" onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'">
            <div class="user-status status-online"></div>
          </div>
          <div class="profile-info">
            <h3 class="profile-name">Pogusik</h3>
            <p class="profile-username">@pogusik</p>

            <div class="profile-divider"></div>

            <div class="profile-badge">
              <i class="fas fa-code"></i> Разработчик CLscript Generator
            </div>

            <div class="profile-actions">
              <a href="discord://-/users/778668132541530132" class="profile-button">
                <i class="fab fa-discord"></i> Написать в Discord
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <style>
      /* Discord профили */
      
      .profile-links {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 20px;
      }
      
      .profile-link {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px;
        background-color: rgba(0, 0, 0, 0.2);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        color: var(--text-color);
        text-decoration: none;
        transition: background-color 0.3s;
      }
      
      .profile-link:hover {
        background-color: rgba(0, 0, 0, 0.4);
      }
      
      .mini-profile-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
      }
      
      .mini-profile-modal.active {
        opacity: 1;
        pointer-events: all;
      }
      
      .mini-profile-content {
        background-color: var(--panel-bg);
        border: 1px solid var(--accent-color);
        width: 340px;
        max-width: 90%;
        position: relative;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        transform: translateY(-20px);
        transition: transform 0.3s;
        overflow: hidden;
        border-radius: 8px;
      }
      
      .mini-profile-modal.active .mini-profile-content {
        transform: translateY(0);
      }
      
      .close-mini-profile {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 24px;
        cursor: pointer;
        color: var(--text-color);
        transition: color 0.2s;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2;
      }
      
      .close-mini-profile:hover {
        color: var(--accent-color);
      }
      
      .profile-banner {
        height: 100px;
        background-size: cover;
        background-position: center;
        position: relative;
      }
      
      .profile-avatar-container {
        position: relative;
        margin-top: -40px;
        padding-left: 20px;
        display: flex;
        align-items: flex-end;
        margin-bottom: 20px;
      }
      
      .profile-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 6px solid var(--panel-bg);
        background-color: var(--panel-bg);
        object-fit: cover;
      }
      
      .server-avatar {
        border-radius: 25%;
      }
      
      .user-status {
        position: absolute;
        bottom: 10px;
        left: 70px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 4px solid var(--panel-bg);
      }
      
      .status-online {
        background-color: #3ba55c;
      }
      
      .status-idle {
        background-color: #faa61a;
      }
      
      .status-dnd {
        background-color: #ed4245;
      }
      
      .status-offline {
        background-color: #737f8d;
      }
      
      .profile-info {
        padding: 0 20px 20px;
      }
      
      .profile-name {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 5px;
        color: var(--text-color);
      }
      
      .profile-username {
        color: var(--gray);
        font-size: 14px;
        margin-bottom: 10px;
      }
      
      .profile-divider {
        height: 1px;
        background-color: var(--border-color);
        margin: 15px 0;
      }
      
      .server-members {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
      }
      
      .server-members-count {
        font-size: 14px;
        color: var(--text-color);
      }
      
      .profile-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }
      
      .profile-button {
        background-color: var(--primary);
        border: none;
        color: white;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-family: inherit;
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: background-color 0.3s;
        font-size: 14px;
        text-decoration: none;
      }
      
      .profile-button:hover {
        background-color: var(--primary-dark);
      }
      
      .profile-badge {
        background-color: #9c84ef;
        color: white;
        font-size: 12px;
        padding: 3px 6px;
        border-radius: 4px;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        margin-bottom: 15px;
      }
      
      .error-message {
        color: #ff6b6b;
        text-align: center;
        margin: 20px 0;
      }
      
      .loading {
        padding: 40px;
        text-align: center;
        color: var(--text-color);
      }
      
      .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        border-top: 4px solid var(--primary);
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }
      
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>

    <script>
      // Обработчики для модального окна профиля
      const profileModal = document.getElementById('user-profile-modal');
      const devProfileLink = document.getElementById('dev-profile-link');
      const closeProfileBtn = document.querySelector('.close-mini-profile');
      // Показать модальное окно
      devProfileLink.addEventListener('click', function(e) {
        e.preventDefault();
        showProfileModal();
      });
      // Закрыть модальное окно
      closeProfileBtn.addEventListener('click', closeProfileModal);
      // Закрыть при клике вне окна
      profileModal.addEventListener('click', function(e) {
        if (e.target === profileModal) {
          closeProfileModal();
        }
      });

      function showProfileModal() {
        profileModal.classList.add('active');
        // Имитация загрузки (можно удалить в реальном приложении)
        setTimeout(() => {
          document.querySelector('.loading').style.display = 'none';
          document.querySelector('.profile-content').style.display = 'block';
        }, 800);
      }

      function closeProfileModal() {
        profileModal.classList.remove('active');
        // Сброс состояния
        setTimeout(() => {
          document.querySelector('.loading').style.display = 'flex';
          document.querySelector('.profile-content').style.display = 'none';
        }, 300);
      }
    </script>
    <!-- Модальное окно уведомлений -->
<div class="notification-modal" id="notificationModal">
  <div class="notification-content" id="notificationContent">
    <div class="notification-header">
      <h3 id="notificationTitle"><i class="fas fa-info-circle"></i> Уведомление</h3>
      <span class="close-modal">&times;</span>
    </div>
    <div class="notification-body">
      <div class="notification-icon">
        <i class="fas fa-info-circle" id="notificationIcon"></i>
      </div>
      <p id="notificationMessage">Сообщение</p>
    </div>
    <div class="notification-footer">
      <button class="btn btn-primary" id="notificationConfirm">OK</button>
    </div>
  </div>
</div>
<script>// Функция для показа модального уведомления
function showModalNotification(title, message, type = 'info') {
  const modal = document.getElementById('notificationModal');
  const content = document.getElementById('notificationContent');
  const icon = document.getElementById('notificationIcon');
  const titleElement = document.getElementById('notificationTitle');
  const messageElement = document.getElementById('notificationMessage');
  
  // Устанавливаем тип уведомления
  content.className = 'notification-content notification-' + type;
  
  // Устанавливаем иконку в зависимости от типа
  let iconClass;
  switch(type) {
    case 'success':
      iconClass = 'fa-check-circle';
      break;
    case 'error':
      iconClass = 'fa-times-circle';
      break;
    case 'warning':
      iconClass = 'fa-exclamation-triangle';
      break;
    default:
      iconClass = 'fa-info-circle';
  }
  
  icon.className = 'fas ' + iconClass;
  titleElement.innerHTML = `<i class="fas ${iconClass}"></i> ${title}`;
  messageElement.textContent = message;
  
  // Показываем модальное окно
  modal.style.display = 'flex';
  
  // Возвращаем промис для обработки закрытия
  return new Promise((resolve) => {
    const confirmBtn = document.getElementById('notificationConfirm');
    const closeBtn = document.querySelector('.close-modal');
    
    const closeHandler = () => {
      modal.style.display = 'none';
      resolve(true);
      // Удаляем обработчики после использования
      confirmBtn.removeEventListener('click', closeHandler);
      closeBtn.removeEventListener('click', closeHandler);
      modal.removeEventListener('click', outsideClickHandler);
    };
    
    const outsideClickHandler = (e) => {
      if (e.target === modal) {
        closeHandler();
      }
    };
    
    confirmBtn.addEventListener('click', closeHandler);
    closeBtn.addEventListener('click', closeHandler);
    modal.addEventListener('click', outsideClickHandler);
  });
}
</script>
</body>

</html>
